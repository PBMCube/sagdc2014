(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function (point, vs) {
    // ray-casting algorithm based on
    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
};

},{}],2:[function(require,module,exports){
var Player = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'happy-man');
    game.add.existing(this);
}

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

module.exports = Player;

},{}],3:[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'sagdc-game');

window.Utils = require('./utils');
window.playerState = {
    UUID: '',
    inventory: [], // List of Item
    currentlyEquipped: null, // Item
    currentLevel: 'BlueRoom'
}

if (Utils.localStorageSupported()) {
     if (localStorage['playerState'] !== undefined) {
        playerState = Utils.getObject('playerState');
    } else {
        playerState.UUID = Utils.generateUUID();   
        Utils.setObject('playerState', playerState);
    }
} else {
    alert("Local storage not supported - you cannot save!");
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
//game.state.add('RedRoom', require('./states/red_test_room'));
game.state.add('BlueRoom', require('./states/blue_test_room'));

game.state.start('Boot');

},{"./states/blue_test_room":4,"./states/boot":5,"./states/game":6,"./states/menu":7,"./states/preloader":8,"./states/splash":9,"./utils":10}],4:[function(require,module,exports){
var Player = require('../entities/player');
var inside = require('point-in-polygon');

var BlueRoom = function () {
  this.player = null;
};

BlueRoom.prototype = {

  create: function () {
		var bg = this.game.add.image(0, 0, 'blue_room');

    var map = this.game.add.tilemap('blue_room');
		var mapBg = map.createLayer('bg');
		this.floorPolygon = extractPolygonFromMap(map, 'floor');

    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.player = new Player(this.game, x, y);

    this.input.onDown.add(this.onInputDown, this);
  },

  onInputDown: function (cursor) {
		console.log(cursor.x, cursor.y);
		console.log(JSON.stringify(this.floorPolygon));
		console.log(inside([cursor.x, cursor.y], this.floorPolygon));
  }
};

var extractPolygonFromMap = function(map, name) {
	var polyObject = map.objects.polygons.filter(function(x) {
		return(x.name == name);
	})[0];
	
	var polygon = polyObject.polygon;
	console.log(JSON.stringify(polygon));
	for(i in polygon) {
		var vertex = polygon[i];
		vertex[0] += polyObject.x;
		vertex[1] += polyObject.y;
	};
	console.log(JSON.stringify(polygon));
	return polygon;
};

module.exports = BlueRoom;

},{"../entities/player":2,"point-in-polygon":1}],5:[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],6:[function(require,module,exports){
var Player = require('../entities/player');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/player":2}],7:[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],8:[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
    this.load.image('happy-man', 'assets/happy-man.png');
    this.load.tilemap('blue_room', 'assets/tilemaps/blue_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('blue_room', 'assets/test_bg_blue.jpg');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],9:[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],10:[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    localStorageSupported: function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },

    generateUUID: function(){
        var d = Date.now();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (d + Math.random()*16)%16 | 0;
            d = Math.floor(d/16);
            return (c=='x' ? r : (r&0x7|0x8)).toString(16);
        });
        return uuid;
    },

    getObject: function(key, value) {
        var value = localStorage.getItem(key);
        return value && JSON.parse(value);
    },

    setObject: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    }
};

module.exports = Utils;
},{}]},{},[3])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9wb2ludC1pbi1wb2x5Z29uL2luZGV4LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvcGxheWVyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvbWFpbi5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9ibHVlX3Rlc3Rfcm9vbS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9ib290LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2dhbWUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvbWVudS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvc3BsYXNoLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHBvaW50LCB2cykge1xuICAgIC8vIHJheS1jYXN0aW5nIGFsZ29yaXRobSBiYXNlZCBvblxuICAgIC8vIGh0dHA6Ly93d3cuZWNzZS5ycGkuZWR1L0hvbWVwYWdlcy93cmYvUmVzZWFyY2gvU2hvcnRfTm90ZXMvcG5wb2x5Lmh0bWxcbiAgICBcbiAgICB2YXIgeCA9IHBvaW50WzBdLCB5ID0gcG9pbnRbMV07XG4gICAgXG4gICAgdmFyIGluc2lkZSA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgPSAwLCBqID0gdnMubGVuZ3RoIC0gMTsgaSA8IHZzLmxlbmd0aDsgaiA9IGkrKykge1xuICAgICAgICB2YXIgeGkgPSB2c1tpXVswXSwgeWkgPSB2c1tpXVsxXTtcbiAgICAgICAgdmFyIHhqID0gdnNbal1bMF0sIHlqID0gdnNbal1bMV07XG4gICAgICAgIFxuICAgICAgICB2YXIgaW50ZXJzZWN0ID0gKCh5aSA+IHkpICE9ICh5aiA+IHkpKVxuICAgICAgICAgICAgJiYgKHggPCAoeGogLSB4aSkgKiAoeSAtIHlpKSAvICh5aiAtIHlpKSArIHhpKTtcbiAgICAgICAgaWYgKGludGVyc2VjdCkgaW5zaWRlID0gIWluc2lkZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGluc2lkZTtcbn07XG4iLCJ2YXIgUGxheWVyID0gZnVuY3Rpb24gKGdhbWUsIHgsIHkpIHtcbiAgICBQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgJ2hhcHB5LW1hbicpO1xuICAgIGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xufVxuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDEwMjQsIDc2OCwgUGhhc2VyLkFVVE8sICdzYWdkYy1nYW1lJyk7XG5cbndpbmRvdy5VdGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcbndpbmRvdy5wbGF5ZXJTdGF0ZSA9IHtcbiAgICBVVUlEOiAnJyxcbiAgICBpbnZlbnRvcnk6IFtdLCAvLyBMaXN0IG9mIEl0ZW1cbiAgICBjdXJyZW50bHlFcXVpcHBlZDogbnVsbCwgLy8gSXRlbVxuICAgIGN1cnJlbnRMZXZlbDogJ0JsdWVSb29tJ1xufVxuXG5pZiAoVXRpbHMubG9jYWxTdG9yYWdlU3VwcG9ydGVkKCkpIHtcbiAgICAgaWYgKGxvY2FsU3RvcmFnZVsncGxheWVyU3RhdGUnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHBsYXllclN0YXRlID0gVXRpbHMuZ2V0T2JqZWN0KCdwbGF5ZXJTdGF0ZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHBsYXllclN0YXRlLlVVSUQgPSBVdGlscy5nZW5lcmF0ZVVVSUQoKTsgICBcbiAgICAgICAgVXRpbHMuc2V0T2JqZWN0KCdwbGF5ZXJTdGF0ZScsIHBsYXllclN0YXRlKTtcbiAgICB9XG59IGVsc2Uge1xuICAgIGFsZXJ0KFwiTG9jYWwgc3RvcmFnZSBub3Qgc3VwcG9ydGVkIC0geW91IGNhbm5vdCBzYXZlIVwiKTtcbn1cblxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XG5nYW1lLnN0YXRlLmFkZCgnTWVudScsIHJlcXVpcmUoJy4vc3RhdGVzL21lbnUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG4vL2dhbWUuc3RhdGUuYWRkKCdSZWRSb29tJywgcmVxdWlyZSgnLi9zdGF0ZXMvcmVkX3Rlc3Rfcm9vbScpKTtcbmdhbWUuc3RhdGUuYWRkKCdCbHVlUm9vbScsIHJlcXVpcmUoJy4vc3RhdGVzL2JsdWVfdGVzdF9yb29tJykpO1xuXG5nYW1lLnN0YXRlLnN0YXJ0KCdCb290Jyk7XG4iLCJ2YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG52YXIgaW5zaWRlID0gcmVxdWlyZSgncG9pbnQtaW4tcG9seWdvbicpO1xuXG52YXIgQmx1ZVJvb20gPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMucGxheWVyID0gbnVsbDtcbn07XG5cbkJsdWVSb29tLnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcblx0XHR2YXIgYmcgPSB0aGlzLmdhbWUuYWRkLmltYWdlKDAsIDAsICdibHVlX3Jvb20nKTtcblxuICAgIHZhciBtYXAgPSB0aGlzLmdhbWUuYWRkLnRpbGVtYXAoJ2JsdWVfcm9vbScpO1xuXHRcdHZhciBtYXBCZyA9IG1hcC5jcmVhdGVMYXllcignYmcnKTtcblx0XHR0aGlzLmZsb29yUG9seWdvbiA9IGV4dHJhY3RQb2x5Z29uRnJvbU1hcChtYXAsICdmbG9vcicpO1xuXG4gICAgdmFyIHggPSAodGhpcy5nYW1lLndpZHRoIC8gMikgLSAxMDA7XG4gICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpIC0gNTA7XG5cbiAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIodGhpcy5nYW1lLCB4LCB5KTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uSW5wdXREb3duLCB0aGlzKTtcbiAgfSxcblxuICBvbklucHV0RG93bjogZnVuY3Rpb24gKGN1cnNvcikge1xuXHRcdGNvbnNvbGUubG9nKGN1cnNvci54LCBjdXJzb3IueSk7XG5cdFx0Y29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkodGhpcy5mbG9vclBvbHlnb24pKTtcblx0XHRjb25zb2xlLmxvZyhpbnNpZGUoW2N1cnNvci54LCBjdXJzb3IueV0sIHRoaXMuZmxvb3JQb2x5Z29uKSk7XG4gIH1cbn07XG5cbnZhciBleHRyYWN0UG9seWdvbkZyb21NYXAgPSBmdW5jdGlvbihtYXAsIG5hbWUpIHtcblx0dmFyIHBvbHlPYmplY3QgPSBtYXAub2JqZWN0cy5wb2x5Z29ucy5maWx0ZXIoZnVuY3Rpb24oeCkge1xuXHRcdHJldHVybih4Lm5hbWUgPT0gbmFtZSk7XG5cdH0pWzBdO1xuXHRcblx0dmFyIHBvbHlnb24gPSBwb2x5T2JqZWN0LnBvbHlnb247XG5cdGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHBvbHlnb24pKTtcblx0Zm9yKGkgaW4gcG9seWdvbikge1xuXHRcdHZhciB2ZXJ0ZXggPSBwb2x5Z29uW2ldO1xuXHRcdHZlcnRleFswXSArPSBwb2x5T2JqZWN0Lng7XG5cdFx0dmVydGV4WzFdICs9IHBvbHlPYmplY3QueTtcblx0fTtcblx0Y29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocG9seWdvbikpO1xuXHRyZXR1cm4gcG9seWdvbjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQmx1ZVJvb207XG4iLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHt9O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7XG5cbkJvb3QucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3ByZWxvYWRlcicsICdhc3NldHMvcHJlbG9hZGVyLmdpZicpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XG5cbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlTW9kZSA9IFBoYXNlci5TdGFnZVNjYWxlTW9kZS5TSE9XX0FMTDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5taW5XaWR0aCA9ICA0ODA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWluSGVpZ2h0ID0gMjYwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5mb3JjZUxhbmRzY2FwZSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5zZXRTY3JlZW5TaXplKHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XG4gIH1cbn07XG4iLCJ2YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG5cbnZhciBHYW1lID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRlc3RlbnRpdHkgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xuXG5HYW1lLnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9ICh0aGlzLmdhbWUud2lkdGggLyAyKSAtIDEwMDtcbiAgICB2YXIgeSA9ICh0aGlzLmdhbWUuaGVpZ2h0IC8gMikgLSA1MDtcblxuICAgIHRoaXMudGVzdGVudGl0eSA9IG5ldyBQbGF5ZXIodGhpcy5nYW1lLCB4LCB5KTtcbiAgICB0aGlzLnRlc3RlbnRpdHkuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uSW5wdXREb3duLCB0aGlzKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCwgeSwgY3gsIGN5LCBkeCwgZHksIGFuZ2xlLCBzY2FsZTtcblxuICAgIHggPSB0aGlzLmlucHV0LnBvc2l0aW9uLng7XG4gICAgeSA9IHRoaXMuaW5wdXQucG9zaXRpb24ueTtcbiAgICBjeCA9IHRoaXMud29ybGQuY2VudGVyWDtcbiAgICBjeSA9IHRoaXMud29ybGQuY2VudGVyWTtcblxuICAgIGFuZ2xlID0gTWF0aC5hdGFuMih5IC0gY3ksIHggLSBjeCkgKiAoMTgwIC8gTWF0aC5QSSk7XG4gICAgdGhpcy50ZXN0ZW50aXR5LmFuZ2xlID0gYW5nbGU7XG5cbiAgICBkeCA9IHggLSBjeDtcbiAgICBkeSA9IHkgLSBjeTtcbiAgICBzY2FsZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSkgLyAxMDA7XG5cbiAgICB0aGlzLnRlc3RlbnRpdHkuc2NhbGUueCA9IHNjYWxlICogMC42O1xuICAgIHRoaXMudGVzdGVudGl0eS5zY2FsZS55ID0gc2NhbGUgKiAwLjY7XG4gIH0sXG5cbiAgb25JbnB1dERvd246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgfVxufTtcbiIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRleHQgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgIHZhciBzdHlsZSA9IHsgZm9udDogXCI2NXB4IEFyaWFsXCIsIGZpbGw6IFwiI2ZmZmZmZlwiLCBhbGlnbjogXCJjZW50ZXJcIiB9O1xuXG4gICAgdGhpcy50ZXh0ID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMjAwLCBcIlByZXNzIHRvIFN0YXJ0XCIsIHN0eWxlKTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XG4gIH1cbn07XG4iLCJ2YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgdGhpcy5hc3NldCA9IG51bGw7XG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xuXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0ID0gdGhpcy5hZGQuc3ByaXRlKDMyMCwgMjQwLCAncHJlbG9hZGVyJyk7XG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCd0ZXN0c3ByaXRlJywgJ2Fzc2V0cy90ZXN0LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnaGFwcHktbWFuJywgJ2Fzc2V0cy9oYXBweS1tYW4ucG5nJyk7XG4gICAgdGhpcy5sb2FkLnRpbGVtYXAoJ2JsdWVfcm9vbScsICdhc3NldHMvdGlsZW1hcHMvYmx1ZV9yb29tLmpzb24nLCBudWxsLCBQaGFzZXIuVGlsZW1hcC5USUxFRF9KU09OKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2JsdWVfcm9vbScsICdhc3NldHMvdGVzdF9iZ19ibHVlLmpwZycpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfVxufTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGxvY2FsU3RvcmFnZVN1cHBvcnRlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gJ2xvY2FsU3RvcmFnZScgaW4gd2luZG93ICYmIHdpbmRvd1snbG9jYWxTdG9yYWdlJ10gIT09IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZW5lcmF0ZVVVSUQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBkID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdmFyIHV1aWQgPSAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpKjE2KSUxNiB8IDA7XG4gICAgICAgICAgICBkID0gTWF0aC5mbG9vcihkLzE2KTtcbiAgICAgICAgICAgIHJldHVybiAoYz09J3gnID8gciA6IChyJjB4N3wweDgpKS50b1N0cmluZygxNik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdXVpZDtcbiAgICB9LFxuXG4gICAgZ2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIHJldHVybiB2YWx1ZSAmJiBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICB9LFxuXG4gICAgc2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzOyJdfQ==
