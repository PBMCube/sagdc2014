(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function (point, vs) {
    // ray-casting algorithm based on
    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
};

},{}],2:[function(require,module,exports){
var inside = require('point-in-polygon');

var ClickablePolygon = function(polyObject) {
    this.name = polyObject.name;

    //The polygon is stored with the first point at 0,0 so we have to position it
    this.polygon = translate(polyObject.x, polyObject.y, polyObject.polygon);
}

ClickablePolygon.prototype.includesPoint = function(x, y) {
    return inside([x, y], this.polygon);
};

var translate = function(x, y, polygon) {
    var poly = polygon.slice(0);
	for(i in poly) {
		var vertex = poly[i];
		vertex[0] += x;
		vertex[1] += y;
	};
    return poly;
};

module.exports = ClickablePolygon;

},{"point-in-polygon":1}],3:[function(require,module,exports){
var Player = function (game, x, y) {
	Phaser.Sprite.call(this, game, x, y, 'happy-man');
	game.add.existing(this);

	this.tween;
	this.anchor.setTo(0.5, 0.95);
		
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

Player.prototype.moveTo = function(x, y, done) {
	console.log(x, y);
	if (this.tween && this.tween.isRunning) {
		this.tween.stop();
	}

	var duration = (this.game.physics.arcade.distanceToXY(this, x, y) / 300) * 1000;
	this.tween = this.game.add.tween(this)
		.to({ x: x, y: y }, duration, Phaser.Easing.Linear.None, true);
	if(done) {
		this.tween.onComplete.add(done, this);
	}
};

module.exports = Player;

},{}],4:[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'sagdc-game');

window.Utils = require('./utils');
window.playerState = {
    UUID: '',
    inventory: [], // List of Item
    currentlyEquipped: null, // Item
    currentLevel: 'BlueRoom'
}

if (Utils.localStorageSupported()) {
     if (localStorage['playerState'] !== undefined) {
        playerState = Utils.getObject('playerState');
    } else {
        playerState.UUID = Utils.generateUUID();   
        Utils.setObject('playerState', playerState);
    }
} else {
    alert("Local storage not supported - you cannot save!");
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('BlueRoom', require('./states/blue_test_room'));
game.state.add('RedRoom', require('./states/red_test_room'));

game.state.start('Boot');

},{"./states/blue_test_room":5,"./states/boot":6,"./states/game":7,"./states/menu":9,"./states/preloader":10,"./states/red_test_room":11,"./states/splash":12,"./utils":13}],5:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var BlueRoom = function() {
  this.map = null;
};

BlueRoom.prototype = new GameScreen();
BlueRoom.prototype.create = function() {
	playerState.currentLevel = 'BlueRoom';

	var bg = this.game.add.image(0, 0, 'blue_room');

	this.map = this.game.add.tilemap('blue_room');
	var mapBg = this.map.createLayer('bg');

	this.initScreen();
};

module.exports = BlueRoom;

},{"../states/game_screen":8}],6:[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],7:[function(require,module,exports){
var Player = require('../entities/player');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/player":3}],8:[function(require,module,exports){
var Player = require('../entities/player');
var ClickablePolygon = require('../entities/clickable_polygon');

var GameScreen = function() {
  this.player = null;
};

GameScreen.prototype = {
  initScreen: function() {
    this.polygons = extractPolygonsFromTileMapLayer(this.map.objects.polygons);

    var x = (this.game.width / 2);
    var y = (this.game.height / 2) + 250;

    this.player = new Player(this.game, x, y);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
  },

  onInputDown: function (cursor) {
    var x = cursor.x,
         y = cursor.y;

    for(i in this.polygons) {
        var polygon = this.polygons[i];
        if(polygon.includesPoint(x, y)) {
            if(polygon.name == 'floor') {
                return this.player.moveTo(x, y);	
            }
            if(polygon.name == 'door') {
                return this.player.moveTo(x, this.player.y, function() {
                    var nextRoom = (playerState.currentLevel == 'BlueRoom') ? 'RedRoom' : 'BlueRoom'; 
                    this.game.state.start(nextRoom);
                });	
            }
        }
    }
  }
};


var extractPolygonsFromTileMapLayer = function(layer) {
	var polys = [];
	for(i in layer) {
		polys.push(new ClickablePolygon(layer[i]));
	}
	return polys;
};

module.exports = GameScreen;

},{"../entities/clickable_polygon":2,"../entities/player":3}],9:[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],10:[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
    this.load.image('happy-man', 'assets/happy-man.png');
    this.load.tilemap('blue_room', 'assets/tilemaps/blue_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.tilemap('red_room', 'assets/tilemaps/red_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('blue_room', 'assets/test_bg_blue.jpg');
    this.load.image('red_room', 'assets/test_bg_red.jpg');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],11:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var RedRoom = function() {
	this.map = null;
};

RedRoom.prototype = new GameScreen();
RedRoom.prototype.create = function() {
	playerState.currentLevel = 'RedRoom';

	var bg = this.game.add.image(0, 0, 'red_room');

	this.map = this.game.add.tilemap('red_room');

	this.initScreen();
};

module.exports = RedRoom;

},{"../states/game_screen":8}],12:[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],13:[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    localStorageSupported: function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },

    generateUUID: function(){
        var d = Date.now();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (d + Math.random()*16)%16 | 0;
            d = Math.floor(d/16);
            return (c=='x' ? r : (r&0x7|0x8)).toString(16);
        });
        return uuid;
    },

    getObject: function(key, value) {
        var value = localStorage.getItem(key);
        return value && JSON.parse(value);
    },

    setObject: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    },

    mergeObject: function(obj1, obj2) {
        var obj3 = {};
        for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
        for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
        return obj3;
    }
};

module.exports = Utils;

},{}]},{},[4])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9wb2ludC1pbi1wb2x5Z29uL2luZGV4LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlX3BvbHlnb24uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9wbGF5ZXIuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9tYWluLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2JsdWVfdGVzdF9yb29tLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2Jvb3QuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9nYW1lX3NjcmVlbi5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9tZW51LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL3ByZWxvYWRlci5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9yZWRfdGVzdF9yb29tLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwb2ludCwgdnMpIHtcbiAgICAvLyByYXktY2FzdGluZyBhbGdvcml0aG0gYmFzZWQgb25cbiAgICAvLyBodHRwOi8vd3d3LmVjc2UucnBpLmVkdS9Ib21lcGFnZXMvd3JmL1Jlc2VhcmNoL1Nob3J0X05vdGVzL3BucG9seS5odG1sXG4gICAgXG4gICAgdmFyIHggPSBwb2ludFswXSwgeSA9IHBvaW50WzFdO1xuICAgIFxuICAgIHZhciBpbnNpZGUgPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpID0gMCwgaiA9IHZzLmxlbmd0aCAtIDE7IGkgPCB2cy5sZW5ndGg7IGogPSBpKyspIHtcbiAgICAgICAgdmFyIHhpID0gdnNbaV1bMF0sIHlpID0gdnNbaV1bMV07XG4gICAgICAgIHZhciB4aiA9IHZzW2pdWzBdLCB5aiA9IHZzW2pdWzFdO1xuICAgICAgICBcbiAgICAgICAgdmFyIGludGVyc2VjdCA9ICgoeWkgPiB5KSAhPSAoeWogPiB5KSlcbiAgICAgICAgICAgICYmICh4IDwgKHhqIC0geGkpICogKHkgLSB5aSkgLyAoeWogLSB5aSkgKyB4aSk7XG4gICAgICAgIGlmIChpbnRlcnNlY3QpIGluc2lkZSA9ICFpbnNpZGU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBpbnNpZGU7XG59O1xuIiwidmFyIGluc2lkZSA9IHJlcXVpcmUoJ3BvaW50LWluLXBvbHlnb24nKTtcblxudmFyIENsaWNrYWJsZVBvbHlnb24gPSBmdW5jdGlvbihwb2x5T2JqZWN0KSB7XG4gICAgdGhpcy5uYW1lID0gcG9seU9iamVjdC5uYW1lO1xuXG4gICAgLy9UaGUgcG9seWdvbiBpcyBzdG9yZWQgd2l0aCB0aGUgZmlyc3QgcG9pbnQgYXQgMCwwIHNvIHdlIGhhdmUgdG8gcG9zaXRpb24gaXRcbiAgICB0aGlzLnBvbHlnb24gPSB0cmFuc2xhdGUocG9seU9iamVjdC54LCBwb2x5T2JqZWN0LnksIHBvbHlPYmplY3QucG9seWdvbik7XG59XG5cbkNsaWNrYWJsZVBvbHlnb24ucHJvdG90eXBlLmluY2x1ZGVzUG9pbnQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgcmV0dXJuIGluc2lkZShbeCwgeV0sIHRoaXMucG9seWdvbik7XG59O1xuXG52YXIgdHJhbnNsYXRlID0gZnVuY3Rpb24oeCwgeSwgcG9seWdvbikge1xuICAgIHZhciBwb2x5ID0gcG9seWdvbi5zbGljZSgwKTtcblx0Zm9yKGkgaW4gcG9seSkge1xuXHRcdHZhciB2ZXJ0ZXggPSBwb2x5W2ldO1xuXHRcdHZlcnRleFswXSArPSB4O1xuXHRcdHZlcnRleFsxXSArPSB5O1xuXHR9O1xuICAgIHJldHVybiBwb2x5O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDbGlja2FibGVQb2x5Z29uO1xuIiwidmFyIFBsYXllciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG5cdFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAnaGFwcHktbWFuJyk7XG5cdGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xuXG5cdHRoaXMudHdlZW47XG5cdHRoaXMuYW5jaG9yLnNldFRvKDAuNSwgMC45NSk7XG5cdFx0XG59O1xuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xufTtcblxuUGxheWVyLnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbih4LCB5LCBkb25lKSB7XG5cdGNvbnNvbGUubG9nKHgsIHkpO1xuXHRpZiAodGhpcy50d2VlbiAmJiB0aGlzLnR3ZWVuLmlzUnVubmluZykge1xuXHRcdHRoaXMudHdlZW4uc3RvcCgpO1xuXHR9XG5cblx0dmFyIGR1cmF0aW9uID0gKHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5kaXN0YW5jZVRvWFkodGhpcywgeCwgeSkgLyAzMDApICogMTAwMDtcblx0dGhpcy50d2VlbiA9IHRoaXMuZ2FtZS5hZGQudHdlZW4odGhpcylcblx0XHQudG8oeyB4OiB4LCB5OiB5IH0sIGR1cmF0aW9uLCBQaGFzZXIuRWFzaW5nLkxpbmVhci5Ob25lLCB0cnVlKTtcblx0aWYoZG9uZSkge1xuXHRcdHRoaXMudHdlZW4ub25Db21wbGV0ZS5hZGQoZG9uZSwgdGhpcyk7XG5cdH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSgxMDI0LCA3NjgsIFBoYXNlci5BVVRPLCAnc2FnZGMtZ2FtZScpO1xuXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG53aW5kb3cucGxheWVyU3RhdGUgPSB7XG4gICAgVVVJRDogJycsXG4gICAgaW52ZW50b3J5OiBbXSwgLy8gTGlzdCBvZiBJdGVtXG4gICAgY3VycmVudGx5RXF1aXBwZWQ6IG51bGwsIC8vIEl0ZW1cbiAgICBjdXJyZW50TGV2ZWw6ICdCbHVlUm9vbSdcbn1cblxuaWYgKFV0aWxzLmxvY2FsU3RvcmFnZVN1cHBvcnRlZCgpKSB7XG4gICAgIGlmIChsb2NhbFN0b3JhZ2VbJ3BsYXllclN0YXRlJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBwbGF5ZXJTdGF0ZSA9IFV0aWxzLmdldE9iamVjdCgncGxheWVyU3RhdGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBwbGF5ZXJTdGF0ZS5VVUlEID0gVXRpbHMuZ2VuZXJhdGVVVUlEKCk7ICAgXG4gICAgICAgIFV0aWxzLnNldE9iamVjdCgncGxheWVyU3RhdGUnLCBwbGF5ZXJTdGF0ZSk7XG4gICAgfVxufSBlbHNlIHtcbiAgICBhbGVydChcIkxvY2FsIHN0b3JhZ2Ugbm90IHN1cHBvcnRlZCAtIHlvdSBjYW5ub3Qgc2F2ZSFcIik7XG59XG5cbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XG5nYW1lLnN0YXRlLmFkZCgnUHJlbG9hZGVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZGVyJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0JsdWVSb29tJywgcmVxdWlyZSgnLi9zdGF0ZXMvYmx1ZV90ZXN0X3Jvb20nKSk7XG5nYW1lLnN0YXRlLmFkZCgnUmVkUm9vbScsIHJlcXVpcmUoJy4vc3RhdGVzL3JlZF90ZXN0X3Jvb20nKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBHYW1lU2NyZWVuID0gcmVxdWlyZSgnLi4vc3RhdGVzL2dhbWVfc2NyZWVuJyk7XG5cbnZhciBCbHVlUm9vbSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm1hcCA9IG51bGw7XG59O1xuXG5CbHVlUm9vbS5wcm90b3R5cGUgPSBuZXcgR2FtZVNjcmVlbigpO1xuQmx1ZVJvb20ucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXHRwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPSAnQmx1ZVJvb20nO1xuXG5cdHZhciBiZyA9IHRoaXMuZ2FtZS5hZGQuaW1hZ2UoMCwgMCwgJ2JsdWVfcm9vbScpO1xuXG5cdHRoaXMubWFwID0gdGhpcy5nYW1lLmFkZC50aWxlbWFwKCdibHVlX3Jvb20nKTtcblx0dmFyIG1hcEJnID0gdGhpcy5tYXAuY3JlYXRlTGF5ZXIoJ2JnJyk7XG5cblx0dGhpcy5pbml0U2NyZWVuKCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJsdWVSb29tO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZU1vZGUgPSBQaGFzZXIuU3RhZ2VTY2FsZU1vZGUuU0hPV19BTEw7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWluV2lkdGggPSAgNDgwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1pbkhlaWdodCA9IDI2MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5tYXhXaWR0aCA9IDY0MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5tYXhIZWlnaHQgPSA0ODA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUuZm9yY2VMYW5kc2NhcGUgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ1ByZWxvYWRlcicpO1xuICB9XG59O1xuIiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL3BsYXllcicpO1xuXG52YXIgR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXN0ZW50aXR5ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSAodGhpcy5nYW1lLndpZHRoIC8gMikgLSAxMDA7XG4gICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpIC0gNTA7XG5cbiAgICB0aGlzLnRlc3RlbnRpdHkgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgeCwgeSk7XG4gICAgdGhpcy50ZXN0ZW50aXR5LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbklucHV0RG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHgsIHksIGN4LCBjeSwgZHgsIGR5LCBhbmdsZSwgc2NhbGU7XG5cbiAgICB4ID0gdGhpcy5pbnB1dC5wb3NpdGlvbi54O1xuICAgIHkgPSB0aGlzLmlucHV0LnBvc2l0aW9uLnk7XG4gICAgY3ggPSB0aGlzLndvcmxkLmNlbnRlclg7XG4gICAgY3kgPSB0aGlzLndvcmxkLmNlbnRlclk7XG5cbiAgICBhbmdsZSA9IE1hdGguYXRhbjIoeSAtIGN5LCB4IC0gY3gpICogKDE4MCAvIE1hdGguUEkpO1xuICAgIHRoaXMudGVzdGVudGl0eS5hbmdsZSA9IGFuZ2xlO1xuXG4gICAgZHggPSB4IC0gY3g7XG4gICAgZHkgPSB5IC0gY3k7XG4gICAgc2NhbGUgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpIC8gMTAwO1xuXG4gICAgdGhpcy50ZXN0ZW50aXR5LnNjYWxlLnggPSBzY2FsZSAqIDAuNjtcbiAgICB0aGlzLnRlc3RlbnRpdHkuc2NhbGUueSA9IHNjYWxlICogMC42O1xuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH1cbn07XG4iLCJ2YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG52YXIgQ2xpY2thYmxlUG9seWdvbiA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NsaWNrYWJsZV9wb2x5Z29uJyk7XG5cbnZhciBHYW1lU2NyZWVuID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucGxheWVyID0gbnVsbDtcbn07XG5cbkdhbWVTY3JlZW4ucHJvdG90eXBlID0ge1xuICBpbml0U2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnBvbHlnb25zID0gZXh0cmFjdFBvbHlnb25zRnJvbVRpbGVNYXBMYXllcih0aGlzLm1hcC5vYmplY3RzLnBvbHlnb25zKTtcblxuICAgIHZhciB4ID0gKHRoaXMuZ2FtZS53aWR0aCAvIDIpO1xuICAgIHZhciB5ID0gKHRoaXMuZ2FtZS5oZWlnaHQgLyAyKSArIDI1MDtcblxuICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcih0aGlzLmdhbWUsIHgsIHkpO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25JbnB1dERvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgdmFyIHggPSBjdXJzb3IueCxcbiAgICAgICAgIHkgPSBjdXJzb3IueTtcblxuICAgIGZvcihpIGluIHRoaXMucG9seWdvbnMpIHtcbiAgICAgICAgdmFyIHBvbHlnb24gPSB0aGlzLnBvbHlnb25zW2ldO1xuICAgICAgICBpZihwb2x5Z29uLmluY2x1ZGVzUG9pbnQoeCwgeSkpIHtcbiAgICAgICAgICAgIGlmKHBvbHlnb24ubmFtZSA9PSAnZmxvb3InKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLm1vdmVUbyh4LCB5KTtcdFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYocG9seWdvbi5uYW1lID09ICdkb29yJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllci5tb3ZlVG8oeCwgdGhpcy5wbGF5ZXIueSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0Um9vbSA9IChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPT0gJ0JsdWVSb29tJykgPyAnUmVkUm9vbScgOiAnQmx1ZVJvb20nOyBcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KG5leHRSb29tKTtcbiAgICAgICAgICAgICAgICB9KTtcdFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5cbnZhciBleHRyYWN0UG9seWdvbnNGcm9tVGlsZU1hcExheWVyID0gZnVuY3Rpb24obGF5ZXIpIHtcblx0dmFyIHBvbHlzID0gW107XG5cdGZvcihpIGluIGxheWVyKSB7XG5cdFx0cG9seXMucHVzaChuZXcgQ2xpY2thYmxlUG9seWdvbihsYXllcltpXSkpO1xuXHR9XG5cdHJldHVybiBwb2x5cztcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZVNjcmVlbjtcbiIsInZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnRleHQgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgeCA9IHRoaXMuZ2FtZS53aWR0aCAvIDI7XG4gICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgIHZhciBzdHlsZSA9IHsgZm9udDogXCI2NXB4IEFyaWFsXCIsIGZpbGw6IFwiI2ZmZmZmZlwiLCBhbGlnbjogXCJjZW50ZXJcIiB9O1xuXG4gICAgdGhpcy50ZXh0ID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMjAwLCBcIlByZXNzIHRvIFN0YXJ0XCIsIHN0eWxlKTtcblxuICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XG4gIH1cbn07XG4iLCJ2YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgdGhpcy5hc3NldCA9IG51bGw7XG4gIHRoaXMucmVhZHkgPSBmYWxzZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyO1xuXG5QcmVsb2FkZXIucHJvdG90eXBlID0ge1xuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0ID0gdGhpcy5hZGQuc3ByaXRlKDMyMCwgMjQwLCAncHJlbG9hZGVyJyk7XG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCd0ZXN0c3ByaXRlJywgJ2Fzc2V0cy90ZXN0LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnaGFwcHktbWFuJywgJ2Fzc2V0cy9oYXBweS1tYW4ucG5nJyk7XG4gICAgdGhpcy5sb2FkLnRpbGVtYXAoJ2JsdWVfcm9vbScsICdhc3NldHMvdGlsZW1hcHMvYmx1ZV9yb29tLmpzb24nLCBudWxsLCBQaGFzZXIuVGlsZW1hcC5USUxFRF9KU09OKTtcbiAgICB0aGlzLmxvYWQudGlsZW1hcCgncmVkX3Jvb20nLCAnYXNzZXRzL3RpbGVtYXBzL3JlZF9yb29tLmpzb24nLCBudWxsLCBQaGFzZXIuVGlsZW1hcC5USUxFRF9KU09OKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2JsdWVfcm9vbScsICdhc3NldHMvdGVzdF9iZ19ibHVlLmpwZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgncmVkX3Jvb20nLCAnYXNzZXRzL3Rlc3RfYmdfcmVkLmpwZycpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfVxufTtcbiIsInZhciBHYW1lU2NyZWVuID0gcmVxdWlyZSgnLi4vc3RhdGVzL2dhbWVfc2NyZWVuJyk7XG5cbnZhciBSZWRSb29tID0gZnVuY3Rpb24oKSB7XG5cdHRoaXMubWFwID0gbnVsbDtcbn07XG5cblJlZFJvb20ucHJvdG90eXBlID0gbmV3IEdhbWVTY3JlZW4oKTtcblJlZFJvb20ucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXHRwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPSAnUmVkUm9vbSc7XG5cblx0dmFyIGJnID0gdGhpcy5nYW1lLmFkZC5pbWFnZSgwLCAwLCAncmVkX3Jvb20nKTtcblxuXHR0aGlzLm1hcCA9IHRoaXMuZ2FtZS5hZGQudGlsZW1hcCgncmVkX3Jvb20nKTtcblxuXHR0aGlzLmluaXRTY3JlZW4oKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmVkUm9vbTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGxvY2FsU3RvcmFnZVN1cHBvcnRlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gJ2xvY2FsU3RvcmFnZScgaW4gd2luZG93ICYmIHdpbmRvd1snbG9jYWxTdG9yYWdlJ10gIT09IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZW5lcmF0ZVVVSUQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBkID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdmFyIHV1aWQgPSAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpKjE2KSUxNiB8IDA7XG4gICAgICAgICAgICBkID0gTWF0aC5mbG9vcihkLzE2KTtcbiAgICAgICAgICAgIHJldHVybiAoYz09J3gnID8gciA6IChyJjB4N3wweDgpKS50b1N0cmluZygxNik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdXVpZDtcbiAgICB9LFxuXG4gICAgZ2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIHJldHVybiB2YWx1ZSAmJiBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICB9LFxuXG4gICAgc2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9LFxuXG4gICAgbWVyZ2VPYmplY3Q6IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgICAgICAgdmFyIG9iajMgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMSkgeyBvYmozW2F0dHJuYW1lXSA9IG9iajFbYXR0cm5hbWVdOyB9XG4gICAgICAgIGZvciAodmFyIGF0dHJuYW1lIGluIG9iajIpIHsgb2JqM1thdHRybmFtZV0gPSBvYmoyW2F0dHJuYW1lXTsgfVxuICAgICAgICByZXR1cm4gb2JqMztcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzO1xuIl19
