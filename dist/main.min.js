(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function (point, vs) {
    // ray-casting algorithm based on
    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
};

},{}],2:[function(require,module,exports){
//This is for making useful objects out of tiled objects

var ClickablePolygon = require('./clickable_polygon');
var ClickableSprite = require('./clickable_sprite');
var Utils = require('../utils');

var Clickable = function(game, tiledObj) {
    if(tiledObj.polygon) {
        ClickablePolygon.call(this, game, tiledObj)
    } else {
        ClickableSprite.call(this, game, tiledObj)
    }

    this.name = tiledObj.name;

    Utils.extend(this, tiledObj.properties);
}

Clickable.prototype.click = function(cursor, state) {
    try {
        this.onClick(cursor, state);
    } catch(err) {
        console.log(this.name, 'onClick');
    }
};

Clickable.prototype.onClick = function(options) {
    throw 'not implemented'
};

module.exports = Clickable;

},{"../utils":19,"./clickable_polygon":4,"./clickable_sprite":5}],3:[function(require,module,exports){
/*
This serves as a registry so the game_screen can automatically make objects
out of what it finds in the Tiled maps.
*/

var clickables = {
    Door: require('./door'),
    Floor: require('./floor'),
    LightSwitch: require('./light_switch'),
};

module.exports.create = function(game, tiledObj) {
    try {
        if(!tiledObj.properties.class) { tiledObj.properties.class = tiledObj.name; }
        var klass = tiledObj.properties.class;
        if(clickables[klass]) {
            return new clickables[klass](game, tiledObj);
        } else {
            throw 'clickable undefined';
        }
    } catch(err) {
        console.log(err + ': ', tiledObj.name);
        return undefined;
    }
};

},{"./door":6,"./floor":7,"./light_switch":8}],4:[function(require,module,exports){
//This is a mixin for making useful objects from tiled polygons

var inside = require('point-in-polygon');

Polygon = function(game, tiledObj) {
    //The polygon is stored with the first point at 0,0 so we have to position it
    this.polygon = translate(tiledObj.x, tiledObj.y, tiledObj.polygon);
    this.includesPoint = function(x, y) {
        return inside([x, y], this.polygon);
    };
};

var translate = function(x, y, polygon) {
    var poly = polygon.slice(0);
	for(i in poly) {
		var vertex = poly[i];
		vertex[0] += x;
		vertex[1] += y;
	};
    return poly;
};

module.exports = Polygon;

},{"point-in-polygon":1}],5:[function(require,module,exports){
//This is a mixin for making Phaser sprites from Tiled objects

var Utils = require('../utils');

var ClickableSprite = function(game, tiledObj) {
    this.x = tiledObj.x;
    this.y = tiledObj.y;

    Utils.extend(this, Object.create(Phaser.Sprite.prototype));
	Phaser.Sprite.call(this, game, tiledObj.x, tiledObj.y, 'light_switch');
	game.add.existing(this);

    var bounds = this.getBounds();
    bounds.offset(this.x, this.y);
    this.includesPoint = function(x, y) {
        return (
            x >= bounds.x &&
            x <= bounds.x + bounds.width &&
            y >= bounds.y &&
            y <= bounds.y + bounds.height
        )
    };
    this.update = function() {};
};

module.exports = ClickableSprite;

},{"../utils":19}],6:[function(require,module,exports){
Clickable = require('./clickable');

Door = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
Door.prototype = Object.create(Clickable.prototype);

Door.prototype.onClick = function(cursor, state) {
    var target = state.points[this.target];
    state.player.moveTo(target.x, target.y, function() {
        if(target.properties.nextSpawnPoint) {
            playerState.spawnPoint = target.properties.nextSpawnPoint;
        }
        state.game.state.start(target.properties.destination);
    });	
}

module.exports = Door;

},{"./clickable":2}],7:[function(require,module,exports){
Clickable = require('./clickable');

Floor = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
Floor.prototype = Object.create(Clickable.prototype);

Floor.prototype.onClick = function(cursor, state) {
    state.player.moveTo(cursor.x, cursor.y);	
}

module.exports = Floor;

},{"./clickable":2}],8:[function(require,module,exports){
Clickable = require('./clickable');

LightSwitch = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
LightSwitch.prototype = Object.create(Clickable.prototype);

LightSwitch.prototype.onClick = function(cursor, state) {
    console.log('LIGHT SWITCH');
}

module.exports = LightSwitch;

},{"./clickable":2}],9:[function(require,module,exports){
var Player = function (game, x, y) {
	Phaser.Sprite.call(this, game, x, y, 'happy-man');
	game.add.existing(this);

	this.movement;
	this.anchor.setTo(0.5, 0.95);
		
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

Player.prototype.moveTo = function(x, y, done) {
	if (this.movement && this.movement.isRunning) {
		this.movement.stop();
	}

	var duration = (this.game.physics.arcade.distanceToXY(this, x, y) / 300) * 1000;
	this.movement = this.game.add.tween(this)
		.to({ x: x, y: y }, duration, Phaser.Easing.Linear.None, true);
	if(done) {
		this.movement.onComplete.add(done, this);
	}
};

module.exports = Player;

},{}],10:[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'sagdc-game');

window.Utils = require('./utils');
window.playerState = {
    UUID: '',
    inventory: [], // List of Item
    currentlyEquipped: null, // Item
    currentLevel: 'BlueRoom'
}

if (Utils.localStorageSupported()) {
     if (localStorage['playerState'] !== undefined) {
        playerState = Utils.getObject('playerState');
    } else {
        playerState.UUID = Utils.generateUUID();   
        Utils.setObject('playerState', playerState);
    }
} else {
    alert("Local storage not supported - you cannot save!");
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('BlueRoom', require('./states/blue_test_room'));
game.state.add('RedRoom', require('./states/red_test_room'));

game.state.start('Boot');

},{"./states/blue_test_room":11,"./states/boot":12,"./states/game":13,"./states/menu":15,"./states/preloader":16,"./states/red_test_room":17,"./states/splash":18,"./utils":19}],11:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var BlueRoom = function() {
  this.map = null;
};

BlueRoom.prototype = new GameScreen();
BlueRoom.prototype.create = function() {
	playerState.currentLevel = 'BlueRoom';

	var bg = this.game.add.image(0, 0, 'blue_room');

	this.map = this.game.add.tilemap('blue_room');
    
	this.initScreen();

    //overriding the default behavior of the lightSwitch
    this.clickables.lightSwitch.onClick = function(cursor, state){
        var player = state.player;
        player.moveTo(this.x, this.y + (player.height / 2), function() {
            console.log('LIGHTS OUT, MOTHERFUCKER');
        });
    };
};

module.exports = BlueRoom;

},{"../states/game_screen":14}],12:[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],13:[function(require,module,exports){
var Player = require('../entities/player');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/player":9}],14:[function(require,module,exports){
//main game screen that the various scenes will inherit

var Player = require('../entities/player');
var ClickableMaker = require('../entities/clickable_maker');

var GameScreen = function() {
    this.player = null;
};

GameScreen.prototype = {
    initScreen: function() {
        this.points = this.extractPointsFromTileMapLayer(this.map.objects.points);
        this.clickables = this.extractClickablesFromTileMapLayer(this.map.objects.clickables);

        if(playerState.spawnPoint && this.points[playerState.spawnPoint]) {
            var point = this.points[playerState.spawnPoint];
            var x = point.x;
            var y = point.y;
        } else {
            var x = (this.game.width / 2);
            var y = (this.game.height / 2) + 250;
        }
        this.player = new Player(this.game, x, y);

        this.input.onDown.add(this.onInputDown, this);
    },

    update: function () {
    },

    onInputDown: function(cursor) {
        for(i in this.clickables) {
            var clickable = this.clickables[i];
            if(clickable.includesPoint(cursor.x, cursor.y)) {
                clickable.click(cursor, this);
            }
        }
    },

    extractPointsFromTileMapLayer: function(layer) {
        var points = {};
        for(i in layer) {
            point = layer[i];
            points[point.name] = point;
        }
        return points;
    },

    extractClickablesFromTileMapLayer: function(layer) {
        var clickables = {};
        for(i in layer) {
            var clickable = ClickableMaker.create(this.game, layer[i]);
            if(clickable) { clickables[clickable.name] = clickable; }
        }
        return clickables;
    },
};

module.exports = GameScreen;

},{"../entities/clickable_maker":3,"../entities/player":9}],15:[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],16:[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
    this.load.image('happy-man', 'assets/happy-man.png');
    this.load.tilemap('blue_room', 'assets/tilemaps/blue_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.tilemap('red_room', 'assets/tilemaps/red_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('blue_room', 'assets/test_bg_blue.jpg');
    this.load.image('red_room', 'assets/test_bg_red.jpg');
    this.load.spritesheet('light_switch', 'assets/light_switch.png', 32, 32);
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],17:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var RedRoom = function() {
	this.map = null;
};

RedRoom.prototype = new GameScreen();
RedRoom.prototype.create = function() {
	playerState.currentLevel = 'RedRoom';

	var bg = this.game.add.image(0, 0, 'red_room');

	this.map = this.game.add.tilemap('red_room');

	this.initScreen();
};

module.exports = RedRoom;

},{"../states/game_screen":14}],18:[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],19:[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    localStorageSupported: function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },

    generateUUID: function(){
        var d = Date.now();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (d + Math.random()*16)%16 | 0;
            d = Math.floor(d/16);
            return (c=='x' ? r : (r&0x7|0x8)).toString(16);
        });
        return uuid;
    },

    getObject: function(key, value) {
        var value = localStorage.getItem(key);
        return value && JSON.parse(value);
    },

    setObject: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    },

    extend: function (target, other) {
      for (var prop in other) {
        if (typeof other[prop] === 'object') {
          target[prop] = extend(target[prop], other[prop]);
        } else {
          target[prop] = other[prop];
        }
      }
      return target;
    }
};

module.exports = Utils;

},{}]},{},[10])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9wb2ludC1pbi1wb2x5Z29uL2luZGV4LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlX21ha2VyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlX3BvbHlnb24uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9jbGlja2FibGVfc3ByaXRlLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvZG9vci5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL2VudGl0aWVzL2Zsb29yLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvbGlnaHRfc3dpdGNoLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvcGxheWVyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvbWFpbi5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9ibHVlX3Rlc3Rfcm9vbS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9ib290LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2dhbWUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvZ2FtZV9zY3JlZW4uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvbWVudS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvcmVkX3Rlc3Rfcm9vbS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChwb2ludCwgdnMpIHtcbiAgICAvLyByYXktY2FzdGluZyBhbGdvcml0aG0gYmFzZWQgb25cbiAgICAvLyBodHRwOi8vd3d3LmVjc2UucnBpLmVkdS9Ib21lcGFnZXMvd3JmL1Jlc2VhcmNoL1Nob3J0X05vdGVzL3BucG9seS5odG1sXG4gICAgXG4gICAgdmFyIHggPSBwb2ludFswXSwgeSA9IHBvaW50WzFdO1xuICAgIFxuICAgIHZhciBpbnNpZGUgPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpID0gMCwgaiA9IHZzLmxlbmd0aCAtIDE7IGkgPCB2cy5sZW5ndGg7IGogPSBpKyspIHtcbiAgICAgICAgdmFyIHhpID0gdnNbaV1bMF0sIHlpID0gdnNbaV1bMV07XG4gICAgICAgIHZhciB4aiA9IHZzW2pdWzBdLCB5aiA9IHZzW2pdWzFdO1xuICAgICAgICBcbiAgICAgICAgdmFyIGludGVyc2VjdCA9ICgoeWkgPiB5KSAhPSAoeWogPiB5KSlcbiAgICAgICAgICAgICYmICh4IDwgKHhqIC0geGkpICogKHkgLSB5aSkgLyAoeWogLSB5aSkgKyB4aSk7XG4gICAgICAgIGlmIChpbnRlcnNlY3QpIGluc2lkZSA9ICFpbnNpZGU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBpbnNpZGU7XG59O1xuIiwiLy9UaGlzIGlzIGZvciBtYWtpbmcgdXNlZnVsIG9iamVjdHMgb3V0IG9mIHRpbGVkIG9iamVjdHNcblxudmFyIENsaWNrYWJsZVBvbHlnb24gPSByZXF1aXJlKCcuL2NsaWNrYWJsZV9wb2x5Z29uJyk7XG52YXIgQ2xpY2thYmxlU3ByaXRlID0gcmVxdWlyZSgnLi9jbGlja2FibGVfc3ByaXRlJyk7XG52YXIgVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xuXG52YXIgQ2xpY2thYmxlID0gZnVuY3Rpb24oZ2FtZSwgdGlsZWRPYmopIHtcbiAgICBpZih0aWxlZE9iai5wb2x5Z29uKSB7XG4gICAgICAgIENsaWNrYWJsZVBvbHlnb24uY2FsbCh0aGlzLCBnYW1lLCB0aWxlZE9iailcbiAgICB9IGVsc2Uge1xuICAgICAgICBDbGlja2FibGVTcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB0aWxlZE9iailcbiAgICB9XG5cbiAgICB0aGlzLm5hbWUgPSB0aWxlZE9iai5uYW1lO1xuXG4gICAgVXRpbHMuZXh0ZW5kKHRoaXMsIHRpbGVkT2JqLnByb3BlcnRpZXMpO1xufVxuXG5DbGlja2FibGUucHJvdG90eXBlLmNsaWNrID0gZnVuY3Rpb24oY3Vyc29yLCBzdGF0ZSkge1xuICAgIHRyeSB7XG4gICAgICAgIHRoaXMub25DbGljayhjdXJzb3IsIHN0YXRlKTtcbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm5hbWUsICdvbkNsaWNrJyk7XG4gICAgfVxufTtcblxuQ2xpY2thYmxlLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHRocm93ICdub3QgaW1wbGVtZW50ZWQnXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENsaWNrYWJsZTtcbiIsIi8qXG5UaGlzIHNlcnZlcyBhcyBhIHJlZ2lzdHJ5IHNvIHRoZSBnYW1lX3NjcmVlbiBjYW4gYXV0b21hdGljYWxseSBtYWtlIG9iamVjdHNcbm91dCBvZiB3aGF0IGl0IGZpbmRzIGluIHRoZSBUaWxlZCBtYXBzLlxuKi9cblxudmFyIGNsaWNrYWJsZXMgPSB7XG4gICAgRG9vcjogcmVxdWlyZSgnLi9kb29yJyksXG4gICAgRmxvb3I6IHJlcXVpcmUoJy4vZmxvb3InKSxcbiAgICBMaWdodFN3aXRjaDogcmVxdWlyZSgnLi9saWdodF9zd2l0Y2gnKSxcbn07XG5cbm1vZHVsZS5leHBvcnRzLmNyZWF0ZSA9IGZ1bmN0aW9uKGdhbWUsIHRpbGVkT2JqKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYoIXRpbGVkT2JqLnByb3BlcnRpZXMuY2xhc3MpIHsgdGlsZWRPYmoucHJvcGVydGllcy5jbGFzcyA9IHRpbGVkT2JqLm5hbWU7IH1cbiAgICAgICAgdmFyIGtsYXNzID0gdGlsZWRPYmoucHJvcGVydGllcy5jbGFzcztcbiAgICAgICAgaWYoY2xpY2thYmxlc1trbGFzc10pIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgY2xpY2thYmxlc1trbGFzc10oZ2FtZSwgdGlsZWRPYmopO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgJ2NsaWNrYWJsZSB1bmRlZmluZWQnO1xuICAgICAgICB9XG4gICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyICsgJzogJywgdGlsZWRPYmoubmFtZSk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxufTtcbiIsIi8vVGhpcyBpcyBhIG1peGluIGZvciBtYWtpbmcgdXNlZnVsIG9iamVjdHMgZnJvbSB0aWxlZCBwb2x5Z29uc1xuXG52YXIgaW5zaWRlID0gcmVxdWlyZSgncG9pbnQtaW4tcG9seWdvbicpO1xuXG5Qb2x5Z29uID0gZnVuY3Rpb24oZ2FtZSwgdGlsZWRPYmopIHtcbiAgICAvL1RoZSBwb2x5Z29uIGlzIHN0b3JlZCB3aXRoIHRoZSBmaXJzdCBwb2ludCBhdCAwLDAgc28gd2UgaGF2ZSB0byBwb3NpdGlvbiBpdFxuICAgIHRoaXMucG9seWdvbiA9IHRyYW5zbGF0ZSh0aWxlZE9iai54LCB0aWxlZE9iai55LCB0aWxlZE9iai5wb2x5Z29uKTtcbiAgICB0aGlzLmluY2x1ZGVzUG9pbnQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHJldHVybiBpbnNpZGUoW3gsIHldLCB0aGlzLnBvbHlnb24pO1xuICAgIH07XG59O1xuXG52YXIgdHJhbnNsYXRlID0gZnVuY3Rpb24oeCwgeSwgcG9seWdvbikge1xuICAgIHZhciBwb2x5ID0gcG9seWdvbi5zbGljZSgwKTtcblx0Zm9yKGkgaW4gcG9seSkge1xuXHRcdHZhciB2ZXJ0ZXggPSBwb2x5W2ldO1xuXHRcdHZlcnRleFswXSArPSB4O1xuXHRcdHZlcnRleFsxXSArPSB5O1xuXHR9O1xuICAgIHJldHVybiBwb2x5O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQb2x5Z29uO1xuIiwiLy9UaGlzIGlzIGEgbWl4aW4gZm9yIG1ha2luZyBQaGFzZXIgc3ByaXRlcyBmcm9tIFRpbGVkIG9iamVjdHNcblxudmFyIFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcblxudmFyIENsaWNrYWJsZVNwcml0ZSA9IGZ1bmN0aW9uKGdhbWUsIHRpbGVkT2JqKSB7XG4gICAgdGhpcy54ID0gdGlsZWRPYmoueDtcbiAgICB0aGlzLnkgPSB0aWxlZE9iai55O1xuXG4gICAgVXRpbHMuZXh0ZW5kKHRoaXMsIE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpKTtcblx0UGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqLngsIHRpbGVkT2JqLnksICdsaWdodF9zd2l0Y2gnKTtcblx0Z2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XG5cbiAgICB2YXIgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMoKTtcbiAgICBib3VuZHMub2Zmc2V0KHRoaXMueCwgdGhpcy55KTtcbiAgICB0aGlzLmluY2x1ZGVzUG9pbnQgPSBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB4ID49IGJvdW5kcy54ICYmXG4gICAgICAgICAgICB4IDw9IGJvdW5kcy54ICsgYm91bmRzLndpZHRoICYmXG4gICAgICAgICAgICB5ID49IGJvdW5kcy55ICYmXG4gICAgICAgICAgICB5IDw9IGJvdW5kcy55ICsgYm91bmRzLmhlaWdodFxuICAgICAgICApXG4gICAgfTtcbiAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge307XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IENsaWNrYWJsZVNwcml0ZTtcbiIsIkNsaWNrYWJsZSA9IHJlcXVpcmUoJy4vY2xpY2thYmxlJyk7XG5cbkRvb3IgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkRvb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGlja2FibGUucHJvdG90eXBlKTtcblxuRG9vci5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uKGN1cnNvciwgc3RhdGUpIHtcbiAgICB2YXIgdGFyZ2V0ID0gc3RhdGUucG9pbnRzW3RoaXMudGFyZ2V0XTtcbiAgICBzdGF0ZS5wbGF5ZXIubW92ZVRvKHRhcmdldC54LCB0YXJnZXQueSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKHRhcmdldC5wcm9wZXJ0aWVzLm5leHRTcGF3blBvaW50KSB7XG4gICAgICAgICAgICBwbGF5ZXJTdGF0ZS5zcGF3blBvaW50ID0gdGFyZ2V0LnByb3BlcnRpZXMubmV4dFNwYXduUG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUuZ2FtZS5zdGF0ZS5zdGFydCh0YXJnZXQucHJvcGVydGllcy5kZXN0aW5hdGlvbik7XG4gICAgfSk7XHRcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBEb29yO1xuIiwiQ2xpY2thYmxlID0gcmVxdWlyZSgnLi9jbGlja2FibGUnKTtcblxuRmxvb3IgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkZsb29yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xpY2thYmxlLnByb3RvdHlwZSk7XG5cbkZsb29yLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24oY3Vyc29yLCBzdGF0ZSkge1xuICAgIHN0YXRlLnBsYXllci5tb3ZlVG8oY3Vyc29yLngsIGN1cnNvci55KTtcdFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZsb29yO1xuIiwiQ2xpY2thYmxlID0gcmVxdWlyZSgnLi9jbGlja2FibGUnKTtcblxuTGlnaHRTd2l0Y2ggPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkxpZ2h0U3dpdGNoLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xpY2thYmxlLnByb3RvdHlwZSk7XG5cbkxpZ2h0U3dpdGNoLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24oY3Vyc29yLCBzdGF0ZSkge1xuICAgIGNvbnNvbGUubG9nKCdMSUdIVCBTV0lUQ0gnKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBMaWdodFN3aXRjaDtcbiIsInZhciBQbGF5ZXIgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuXHRQaGFzZXIuU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgeCwgeSwgJ2hhcHB5LW1hbicpO1xuXHRnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcblxuXHR0aGlzLm1vdmVtZW50O1xuXHR0aGlzLmFuY2hvci5zZXRUbygwLjUsIDAuOTUpO1xuXHRcdFxufTtcblxuUGxheWVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xuUGxheWVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFBsYXllcjtcblxuLyoqXG4gKiBBdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBXb3JsZC51cGRhdGVcbiAqL1xuUGxheWVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbn07XG5cblBsYXllci5wcm90b3R5cGUubW92ZVRvID0gZnVuY3Rpb24oeCwgeSwgZG9uZSkge1xuXHRpZiAodGhpcy5tb3ZlbWVudCAmJiB0aGlzLm1vdmVtZW50LmlzUnVubmluZykge1xuXHRcdHRoaXMubW92ZW1lbnQuc3RvcCgpO1xuXHR9XG5cblx0dmFyIGR1cmF0aW9uID0gKHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5kaXN0YW5jZVRvWFkodGhpcywgeCwgeSkgLyAzMDApICogMTAwMDtcblx0dGhpcy5tb3ZlbWVudCA9IHRoaXMuZ2FtZS5hZGQudHdlZW4odGhpcylcblx0XHQudG8oeyB4OiB4LCB5OiB5IH0sIGR1cmF0aW9uLCBQaGFzZXIuRWFzaW5nLkxpbmVhci5Ob25lLCB0cnVlKTtcblx0aWYoZG9uZSkge1xuXHRcdHRoaXMubW92ZW1lbnQub25Db21wbGV0ZS5hZGQoZG9uZSwgdGhpcyk7XG5cdH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSgxMDI0LCA3NjgsIFBoYXNlci5BVVRPLCAnc2FnZGMtZ2FtZScpO1xuXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzJyk7XG53aW5kb3cucGxheWVyU3RhdGUgPSB7XG4gICAgVVVJRDogJycsXG4gICAgaW52ZW50b3J5OiBbXSwgLy8gTGlzdCBvZiBJdGVtXG4gICAgY3VycmVudGx5RXF1aXBwZWQ6IG51bGwsIC8vIEl0ZW1cbiAgICBjdXJyZW50TGV2ZWw6ICdCbHVlUm9vbSdcbn1cblxuaWYgKFV0aWxzLmxvY2FsU3RvcmFnZVN1cHBvcnRlZCgpKSB7XG4gICAgIGlmIChsb2NhbFN0b3JhZ2VbJ3BsYXllclN0YXRlJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBwbGF5ZXJTdGF0ZSA9IFV0aWxzLmdldE9iamVjdCgncGxheWVyU3RhdGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBwbGF5ZXJTdGF0ZS5VVUlEID0gVXRpbHMuZ2VuZXJhdGVVVUlEKCk7ICAgXG4gICAgICAgIFV0aWxzLnNldE9iamVjdCgncGxheWVyU3RhdGUnLCBwbGF5ZXJTdGF0ZSk7XG4gICAgfVxufSBlbHNlIHtcbiAgICBhbGVydChcIkxvY2FsIHN0b3JhZ2Ugbm90IHN1cHBvcnRlZCAtIHlvdSBjYW5ub3Qgc2F2ZSFcIik7XG59XG5cbmdhbWUuc3RhdGUuYWRkKCdCb290JywgcmVxdWlyZSgnLi9zdGF0ZXMvYm9vdCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdTcGxhc2gnLCByZXF1aXJlKCcuL3N0YXRlcy9zcGxhc2gnKSk7XG5nYW1lLnN0YXRlLmFkZCgnUHJlbG9hZGVyJywgcmVxdWlyZSgnLi9zdGF0ZXMvcHJlbG9hZGVyJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ01lbnUnLCByZXF1aXJlKCcuL3N0YXRlcy9tZW51JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0dhbWUnLCByZXF1aXJlKCcuL3N0YXRlcy9nYW1lJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ0JsdWVSb29tJywgcmVxdWlyZSgnLi9zdGF0ZXMvYmx1ZV90ZXN0X3Jvb20nKSk7XG5nYW1lLnN0YXRlLmFkZCgnUmVkUm9vbScsIHJlcXVpcmUoJy4vc3RhdGVzL3JlZF90ZXN0X3Jvb20nKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBHYW1lU2NyZWVuID0gcmVxdWlyZSgnLi4vc3RhdGVzL2dhbWVfc2NyZWVuJyk7XG5cbnZhciBCbHVlUm9vbSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLm1hcCA9IG51bGw7XG59O1xuXG5CbHVlUm9vbS5wcm90b3R5cGUgPSBuZXcgR2FtZVNjcmVlbigpO1xuQmx1ZVJvb20ucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXHRwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPSAnQmx1ZVJvb20nO1xuXG5cdHZhciBiZyA9IHRoaXMuZ2FtZS5hZGQuaW1hZ2UoMCwgMCwgJ2JsdWVfcm9vbScpO1xuXG5cdHRoaXMubWFwID0gdGhpcy5nYW1lLmFkZC50aWxlbWFwKCdibHVlX3Jvb20nKTtcbiAgICBcblx0dGhpcy5pbml0U2NyZWVuKCk7XG5cbiAgICAvL292ZXJyaWRpbmcgdGhlIGRlZmF1bHQgYmVoYXZpb3Igb2YgdGhlIGxpZ2h0U3dpdGNoXG4gICAgdGhpcy5jbGlja2FibGVzLmxpZ2h0U3dpdGNoLm9uQ2xpY2sgPSBmdW5jdGlvbihjdXJzb3IsIHN0YXRlKXtcbiAgICAgICAgdmFyIHBsYXllciA9IHN0YXRlLnBsYXllcjtcbiAgICAgICAgcGxheWVyLm1vdmVUbyh0aGlzLngsIHRoaXMueSArIChwbGF5ZXIuaGVpZ2h0IC8gMiksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0xJR0hUUyBPVVQsIE1PVEhFUkZVQ0tFUicpO1xuICAgICAgICB9KTtcbiAgICB9O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCbHVlUm9vbTtcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge307XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vdDtcblxuQm9vdC5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyJywgJ2Fzc2V0cy9wcmVsb2FkZXIuZ2lmJyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcblxuICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGVNb2RlID0gUGhhc2VyLlN0YWdlU2NhbGVNb2RlLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1pbldpZHRoID0gIDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWF4V2lkdGggPSA2NDA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWF4SGVpZ2h0ID0gNDgwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsInZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9wbGF5ZXInKTtcblxudmFyIEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGVzdGVudGl0eSA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4ID0gKHRoaXMuZ2FtZS53aWR0aCAvIDIpIC0gMTAwO1xuICAgIHZhciB5ID0gKHRoaXMuZ2FtZS5oZWlnaHQgLyAyKSAtIDUwO1xuXG4gICAgdGhpcy50ZXN0ZW50aXR5ID0gbmV3IFBsYXllcih0aGlzLmdhbWUsIHgsIHkpO1xuICAgIHRoaXMudGVzdGVudGl0eS5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25JbnB1dERvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4LCB5LCBjeCwgY3ksIGR4LCBkeSwgYW5nbGUsIHNjYWxlO1xuXG4gICAgeCA9IHRoaXMuaW5wdXQucG9zaXRpb24ueDtcbiAgICB5ID0gdGhpcy5pbnB1dC5wb3NpdGlvbi55O1xuICAgIGN4ID0gdGhpcy53b3JsZC5jZW50ZXJYO1xuICAgIGN5ID0gdGhpcy53b3JsZC5jZW50ZXJZO1xuXG4gICAgYW5nbGUgPSBNYXRoLmF0YW4yKHkgLSBjeSwgeCAtIGN4KSAqICgxODAgLyBNYXRoLlBJKTtcbiAgICB0aGlzLnRlc3RlbnRpdHkuYW5nbGUgPSBhbmdsZTtcblxuICAgIGR4ID0geCAtIGN4O1xuICAgIGR5ID0geSAtIGN5O1xuICAgIHNjYWxlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KSAvIDEwMDtcblxuICAgIHRoaXMudGVzdGVudGl0eS5zY2FsZS54ID0gc2NhbGUgKiAwLjY7XG4gICAgdGhpcy50ZXN0ZW50aXR5LnNjYWxlLnkgPSBzY2FsZSAqIDAuNjtcbiAgfSxcblxuICBvbklucHV0RG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICB9XG59O1xuIiwiLy9tYWluIGdhbWUgc2NyZWVuIHRoYXQgdGhlIHZhcmlvdXMgc2NlbmVzIHdpbGwgaW5oZXJpdFxuXG52YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG52YXIgQ2xpY2thYmxlTWFrZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jbGlja2FibGVfbWFrZXInKTtcblxudmFyIEdhbWVTY3JlZW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnBsYXllciA9IG51bGw7XG59O1xuXG5HYW1lU2NyZWVuLnByb3RvdHlwZSA9IHtcbiAgICBpbml0U2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5wb2ludHMgPSB0aGlzLmV4dHJhY3RQb2ludHNGcm9tVGlsZU1hcExheWVyKHRoaXMubWFwLm9iamVjdHMucG9pbnRzKTtcbiAgICAgICAgdGhpcy5jbGlja2FibGVzID0gdGhpcy5leHRyYWN0Q2xpY2thYmxlc0Zyb21UaWxlTWFwTGF5ZXIodGhpcy5tYXAub2JqZWN0cy5jbGlja2FibGVzKTtcblxuICAgICAgICBpZihwbGF5ZXJTdGF0ZS5zcGF3blBvaW50ICYmIHRoaXMucG9pbnRzW3BsYXllclN0YXRlLnNwYXduUG9pbnRdKSB7XG4gICAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLnBvaW50c1twbGF5ZXJTdGF0ZS5zcGF3blBvaW50XTtcbiAgICAgICAgICAgIHZhciB4ID0gcG9pbnQueDtcbiAgICAgICAgICAgIHZhciB5ID0gcG9pbnQueTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciB4ID0gKHRoaXMuZ2FtZS53aWR0aCAvIDIpO1xuICAgICAgICAgICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpICsgMjUwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGxheWVyID0gbmV3IFBsYXllcih0aGlzLmdhbWUsIHgsIHkpO1xuXG4gICAgICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uSW5wdXREb3duLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgfSxcblxuICAgIG9uSW5wdXREb3duOiBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgZm9yKGkgaW4gdGhpcy5jbGlja2FibGVzKSB7XG4gICAgICAgICAgICB2YXIgY2xpY2thYmxlID0gdGhpcy5jbGlja2FibGVzW2ldO1xuICAgICAgICAgICAgaWYoY2xpY2thYmxlLmluY2x1ZGVzUG9pbnQoY3Vyc29yLngsIGN1cnNvci55KSkge1xuICAgICAgICAgICAgICAgIGNsaWNrYWJsZS5jbGljayhjdXJzb3IsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGV4dHJhY3RQb2ludHNGcm9tVGlsZU1hcExheWVyOiBmdW5jdGlvbihsYXllcikge1xuICAgICAgICB2YXIgcG9pbnRzID0ge307XG4gICAgICAgIGZvcihpIGluIGxheWVyKSB7XG4gICAgICAgICAgICBwb2ludCA9IGxheWVyW2ldO1xuICAgICAgICAgICAgcG9pbnRzW3BvaW50Lm5hbWVdID0gcG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvaW50cztcbiAgICB9LFxuXG4gICAgZXh0cmFjdENsaWNrYWJsZXNGcm9tVGlsZU1hcExheWVyOiBmdW5jdGlvbihsYXllcikge1xuICAgICAgICB2YXIgY2xpY2thYmxlcyA9IHt9O1xuICAgICAgICBmb3IoaSBpbiBsYXllcikge1xuICAgICAgICAgICAgdmFyIGNsaWNrYWJsZSA9IENsaWNrYWJsZU1ha2VyLmNyZWF0ZSh0aGlzLmdhbWUsIGxheWVyW2ldKTtcbiAgICAgICAgICAgIGlmKGNsaWNrYWJsZSkgeyBjbGlja2FibGVzW2NsaWNrYWJsZS5uYW1lXSA9IGNsaWNrYWJsZTsgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjbGlja2FibGVzO1xuICAgIH0sXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVTY3JlZW47XG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXh0ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6IFwiNjVweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgndGVzdHNwcml0ZScsICdhc3NldHMvdGVzdC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2hhcHB5LW1hbicsICdhc3NldHMvaGFwcHktbWFuLnBuZycpO1xuICAgIHRoaXMubG9hZC50aWxlbWFwKCdibHVlX3Jvb20nLCAnYXNzZXRzL3RpbGVtYXBzL2JsdWVfcm9vbS5qc29uJywgbnVsbCwgUGhhc2VyLlRpbGVtYXAuVElMRURfSlNPTik7XG4gICAgdGhpcy5sb2FkLnRpbGVtYXAoJ3JlZF9yb29tJywgJ2Fzc2V0cy90aWxlbWFwcy9yZWRfcm9vbS5qc29uJywgbnVsbCwgUGhhc2VyLlRpbGVtYXAuVElMRURfSlNPTik7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdibHVlX3Jvb20nLCAnYXNzZXRzL3Rlc3RfYmdfYmx1ZS5qcGcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3JlZF9yb29tJywgJ2Fzc2V0cy90ZXN0X2JnX3JlZC5qcGcnKTtcbiAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2xpZ2h0X3N3aXRjaCcsICdhc3NldHMvbGlnaHRfc3dpdGNoLnBuZycsIDMyLCAzMik7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICAgIH1cbiAgfSxcblxuICBvbkxvYWRDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9XG59O1xuIiwidmFyIEdhbWVTY3JlZW4gPSByZXF1aXJlKCcuLi9zdGF0ZXMvZ2FtZV9zY3JlZW4nKTtcblxudmFyIFJlZFJvb20gPSBmdW5jdGlvbigpIHtcblx0dGhpcy5tYXAgPSBudWxsO1xufTtcblxuUmVkUm9vbS5wcm90b3R5cGUgPSBuZXcgR2FtZVNjcmVlbigpO1xuUmVkUm9vbS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24oKSB7XG5cdHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCA9ICdSZWRSb29tJztcblxuXHR2YXIgYmcgPSB0aGlzLmdhbWUuYWRkLmltYWdlKDAsIDAsICdyZWRfcm9vbScpO1xuXG5cdHRoaXMubWFwID0gdGhpcy5nYW1lLmFkZC50aWxlbWFwKCdyZWRfcm9vbScpO1xuXG5cdHRoaXMuaW5pdFNjcmVlbigpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWRSb29tO1xuIiwidmFyIFNwbGFzaCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gU3BsYXNoO1xuXG5TcGxhc2gucHJvdG90eXBlID0ge1xuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uKG9iaiwgbGlzdCkge1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChsaXN0W2ldID09PSBvYmopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgbG9jYWxTdG9yYWdlU3VwcG9ydGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiAnbG9jYWxTdG9yYWdlJyBpbiB3aW5kb3cgJiYgd2luZG93Wydsb2NhbFN0b3JhZ2UnXSAhPT0gbnVsbDtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdlbmVyYXRlVVVJRDogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIGQgPSBEYXRlLm5vdygpO1xuICAgICAgICB2YXIgdXVpZCA9ICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykge1xuICAgICAgICAgICAgdmFyIHIgPSAoZCArIE1hdGgucmFuZG9tKCkqMTYpJTE2IHwgMDtcbiAgICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGQvMTYpO1xuICAgICAgICAgICAgcmV0dXJuIChjPT0neCcgPyByIDogKHImMHg3fDB4OCkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB1dWlkO1xuICAgIH0sXG5cbiAgICBnZXRPYmplY3Q6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgcmV0dXJuIHZhbHVlICYmIEpTT04ucGFyc2UodmFsdWUpO1xuICAgIH0sXG5cbiAgICBzZXRPYmplY3Q6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgIH0sXG5cbiAgICBleHRlbmQ6IGZ1bmN0aW9uICh0YXJnZXQsIG90aGVyKSB7XG4gICAgICBmb3IgKHZhciBwcm9wIGluIG90aGVyKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb3RoZXJbcHJvcF0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgdGFyZ2V0W3Byb3BdID0gZXh0ZW5kKHRhcmdldFtwcm9wXSwgb3RoZXJbcHJvcF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldFtwcm9wXSA9IG90aGVyW3Byb3BdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGFyZ2V0O1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7XG4iXX0=
