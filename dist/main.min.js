(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function (point, vs) {
    // ray-casting algorithm based on
    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
};

},{}],2:[function(require,module,exports){
//This is for making useful objects out of tiled objects

var Polygon = require('./polygon');
var Utils = require('../utils');

var Clickable = function(tiledObj) {
    this.name = tiledObj.name;

    if(tiledObj.polygon) { Polygon.call(this, tiledObj) }

    Utils.extend(this, tiledObj.properties);
}


Door = function(tiledObj) {
    Clickable.call(this, tiledObj);
}

Floor = function(tiledObj) {
    Clickable.call(this, tiledObj);
}

clickables = {
    door: Door,
    floor: Floor,
}

module.exports.create = function(tiledObj) {
    return new clickables[tiledObj.name](tiledObj);
}

},{"../utils":14,"./polygon":4}],3:[function(require,module,exports){
var Player = function (game, x, y) {
	Phaser.Sprite.call(this, game, x, y, 'happy-man');
	game.add.existing(this);

	this.movement;
	this.anchor.setTo(0.5, 0.95);
		
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

Player.prototype.moveTo = function(x, y, done) {
	console.log(x, y);
	if (this.movement && this.movement.isRunning) {
		this.movement.stop();
	}

	var duration = (this.game.physics.arcade.distanceToXY(this, x, y) / 300) * 1000;
	this.movement = this.game.add.tween(this)
		.to({ x: x, y: y }, duration, Phaser.Easing.Linear.None, true);
	if(done) {
		this.movement.onComplete.add(done, this);
	}
};

module.exports = Player;

},{}],4:[function(require,module,exports){
//This is a mixin for making useful objects from tiled polygons

var inside = require('point-in-polygon');

Polygon = function(tiledObj) {
    //The polygon is stored with the first point at 0,0 so we have to position it
    this.polygon = translate(tiledObj.x, tiledObj.y, tiledObj.polygon);
    this.includesPoint = function(x, y) {
        return inside([x, y], this.polygon);
    };
};

var translate = function(x, y, polygon) {
    var poly = polygon.slice(0);
	for(i in poly) {
		var vertex = poly[i];
		vertex[0] += x;
		vertex[1] += y;
	};
    return poly;
};

module.exports = Polygon;

},{"point-in-polygon":1}],5:[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'sagdc-game');

window.Utils = require('./utils');
window.playerState = {
    UUID: '',
    inventory: [], // List of Item
    currentlyEquipped: null, // Item
    currentLevel: 'BlueRoom'
}

if (Utils.localStorageSupported()) {
     if (localStorage['playerState'] !== undefined) {
        playerState = Utils.getObject('playerState');
    } else {
        playerState.UUID = Utils.generateUUID();   
        Utils.setObject('playerState', playerState);
    }
} else {
    alert("Local storage not supported - you cannot save!");
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('BlueRoom', require('./states/blue_test_room'));
game.state.add('RedRoom', require('./states/red_test_room'));

game.state.start('Boot');

},{"./states/blue_test_room":6,"./states/boot":7,"./states/game":8,"./states/menu":10,"./states/preloader":11,"./states/red_test_room":12,"./states/splash":13,"./utils":14}],6:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var BlueRoom = function() {
  this.map = null;
};

BlueRoom.prototype = new GameScreen();
BlueRoom.prototype.create = function() {
	playerState.currentLevel = 'BlueRoom';

	var bg = this.game.add.image(0, 0, 'blue_room');

	this.map = this.game.add.tilemap('blue_room');
	var mapBg = this.map.createLayer('bg');

	this.initScreen();
};

module.exports = BlueRoom;

},{"../states/game_screen":9}],7:[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],8:[function(require,module,exports){
var Player = require('../entities/player');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/player":3}],9:[function(require,module,exports){
//main game screen that the various scenes will inherit

var Player = require('../entities/player');
var Clickable = require('../entities/clickable');

var GameScreen = function() {
  this.player = null;
};

GameScreen.prototype = {
  initScreen: function() {
    this.points = extractPointsFromTileMapLayer(this.map.objects.points);
    this.clickables = extractClickablesFromTileMapLayer(this.map.objects.clickable_polygons);

    var x = (this.game.width / 2);
    var y = (this.game.height / 2) + 250;

    this.player = new Player(this.game, x, y);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
  },

  onInputDown: function (cursor) {
    var x = cursor.x,
         y = cursor.y;

    for(i in this.clickables) {
        var clickable = this.clickables[i];
        if(clickable.includesPoint(x, y)) {
            if(clickable.name == 'floor') {
                return this.player.moveTo(x, y);	
            }
            if(clickable.name == 'door') {
                return this.player.moveTo(x, this.player.y, function() {
                    var nextRoom = (playerState.currentLevel == 'BlueRoom') ? 'RedRoom' : 'BlueRoom'; 
                    this.game.state.start(nextRoom);
                });	
            }
        }
    }
  }
};

var extractPointsFromTileMapLayer = function(layer) {
	var points = [];
	for(i in layer) {
		points.push(layer[i]);
	}
	return points;
};

var extractClickablesFromTileMapLayer = function(layer) {
	var clickables = [];
	for(i in layer) {
		clickables.push(Clickable.create(layer[i]));
	}
	return clickables;
};

module.exports = GameScreen;

},{"../entities/clickable":2,"../entities/player":3}],10:[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],11:[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
    this.load.image('happy-man', 'assets/happy-man.png');
    this.load.tilemap('blue_room', 'assets/tilemaps/blue_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.tilemap('red_room', 'assets/tilemaps/red_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('blue_room', 'assets/test_bg_blue.jpg');
    this.load.image('red_room', 'assets/test_bg_red.jpg');
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],12:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var RedRoom = function() {
	this.map = null;
};

RedRoom.prototype = new GameScreen();
RedRoom.prototype.create = function() {
	playerState.currentLevel = 'RedRoom';

	var bg = this.game.add.image(0, 0, 'red_room');

	this.map = this.game.add.tilemap('red_room');

	this.initScreen();
};

module.exports = RedRoom;

},{"../states/game_screen":9}],13:[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],14:[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    localStorageSupported: function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },

    generateUUID: function(){
        var d = Date.now();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (d + Math.random()*16)%16 | 0;
            d = Math.floor(d/16);
            return (c=='x' ? r : (r&0x7|0x8)).toString(16);
        });
        return uuid;
    },

    getObject: function(key, value) {
        var value = localStorage.getItem(key);
        return value && JSON.parse(value);
    },

    setObject: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    },

    extend: function (target, other) {
      for (var prop in other) {
        if (typeof other[prop] === 'object') {
          target[prop] = extend(target[prop], other[prop]);
        } else {
          target[prop] = other[prop];
        }
      }
      return target;
    }
};

module.exports = Utils;

},{}]},{},[5])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9wb2ludC1pbi1wb2x5Z29uL2luZGV4LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvcGxheWVyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvcG9seWdvbi5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL21haW4uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvYmx1ZV90ZXN0X3Jvb20uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvYm9vdC5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2dhbWVfc2NyZWVuLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL21lbnUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL3JlZF90ZXN0X3Jvb20uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvc3BsYXNoLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHBvaW50LCB2cykge1xuICAgIC8vIHJheS1jYXN0aW5nIGFsZ29yaXRobSBiYXNlZCBvblxuICAgIC8vIGh0dHA6Ly93d3cuZWNzZS5ycGkuZWR1L0hvbWVwYWdlcy93cmYvUmVzZWFyY2gvU2hvcnRfTm90ZXMvcG5wb2x5Lmh0bWxcbiAgICBcbiAgICB2YXIgeCA9IHBvaW50WzBdLCB5ID0gcG9pbnRbMV07XG4gICAgXG4gICAgdmFyIGluc2lkZSA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgPSAwLCBqID0gdnMubGVuZ3RoIC0gMTsgaSA8IHZzLmxlbmd0aDsgaiA9IGkrKykge1xuICAgICAgICB2YXIgeGkgPSB2c1tpXVswXSwgeWkgPSB2c1tpXVsxXTtcbiAgICAgICAgdmFyIHhqID0gdnNbal1bMF0sIHlqID0gdnNbal1bMV07XG4gICAgICAgIFxuICAgICAgICB2YXIgaW50ZXJzZWN0ID0gKCh5aSA+IHkpICE9ICh5aiA+IHkpKVxuICAgICAgICAgICAgJiYgKHggPCAoeGogLSB4aSkgKiAoeSAtIHlpKSAvICh5aiAtIHlpKSArIHhpKTtcbiAgICAgICAgaWYgKGludGVyc2VjdCkgaW5zaWRlID0gIWluc2lkZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGluc2lkZTtcbn07XG4iLCIvL1RoaXMgaXMgZm9yIG1ha2luZyB1c2VmdWwgb2JqZWN0cyBvdXQgb2YgdGlsZWQgb2JqZWN0c1xuXG52YXIgUG9seWdvbiA9IHJlcXVpcmUoJy4vcG9seWdvbicpO1xudmFyIFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcblxudmFyIENsaWNrYWJsZSA9IGZ1bmN0aW9uKHRpbGVkT2JqKSB7XG4gICAgdGhpcy5uYW1lID0gdGlsZWRPYmoubmFtZTtcblxuICAgIGlmKHRpbGVkT2JqLnBvbHlnb24pIHsgUG9seWdvbi5jYWxsKHRoaXMsIHRpbGVkT2JqKSB9XG5cbiAgICBVdGlscy5leHRlbmQodGhpcywgdGlsZWRPYmoucHJvcGVydGllcyk7XG59XG5cblxuRG9vciA9IGZ1bmN0aW9uKHRpbGVkT2JqKSB7XG4gICAgQ2xpY2thYmxlLmNhbGwodGhpcywgdGlsZWRPYmopO1xufVxuXG5GbG9vciA9IGZ1bmN0aW9uKHRpbGVkT2JqKSB7XG4gICAgQ2xpY2thYmxlLmNhbGwodGhpcywgdGlsZWRPYmopO1xufVxuXG5jbGlja2FibGVzID0ge1xuICAgIGRvb3I6IERvb3IsXG4gICAgZmxvb3I6IEZsb29yLFxufVxuXG5tb2R1bGUuZXhwb3J0cy5jcmVhdGUgPSBmdW5jdGlvbih0aWxlZE9iaikge1xuICAgIHJldHVybiBuZXcgY2xpY2thYmxlc1t0aWxlZE9iai5uYW1lXSh0aWxlZE9iaik7XG59XG4iLCJ2YXIgUGxheWVyID0gZnVuY3Rpb24gKGdhbWUsIHgsIHkpIHtcblx0UGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICdoYXBweS1tYW4nKTtcblx0Z2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XG5cblx0dGhpcy5tb3ZlbWVudDtcblx0dGhpcy5hbmNob3Iuc2V0VG8oMC41LCAwLjk1KTtcblx0XHRcbn07XG5cblBsYXllci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblBsYXllci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQbGF5ZXI7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cblBsYXllci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG59O1xuXG5QbGF5ZXIucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uKHgsIHksIGRvbmUpIHtcblx0Y29uc29sZS5sb2coeCwgeSk7XG5cdGlmICh0aGlzLm1vdmVtZW50ICYmIHRoaXMubW92ZW1lbnQuaXNSdW5uaW5nKSB7XG5cdFx0dGhpcy5tb3ZlbWVudC5zdG9wKCk7XG5cdH1cblxuXHR2YXIgZHVyYXRpb24gPSAodGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWSh0aGlzLCB4LCB5KSAvIDMwMCkgKiAxMDAwO1xuXHR0aGlzLm1vdmVtZW50ID0gdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzKVxuXHRcdC50byh7IHg6IHgsIHk6IHkgfSwgZHVyYXRpb24sIFBoYXNlci5FYXNpbmcuTGluZWFyLk5vbmUsIHRydWUpO1xuXHRpZihkb25lKSB7XG5cdFx0dGhpcy5tb3ZlbWVudC5vbkNvbXBsZXRlLmFkZChkb25lLCB0aGlzKTtcblx0fVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCIvL1RoaXMgaXMgYSBtaXhpbiBmb3IgbWFraW5nIHVzZWZ1bCBvYmplY3RzIGZyb20gdGlsZWQgcG9seWdvbnNcblxudmFyIGluc2lkZSA9IHJlcXVpcmUoJ3BvaW50LWluLXBvbHlnb24nKTtcblxuUG9seWdvbiA9IGZ1bmN0aW9uKHRpbGVkT2JqKSB7XG4gICAgLy9UaGUgcG9seWdvbiBpcyBzdG9yZWQgd2l0aCB0aGUgZmlyc3QgcG9pbnQgYXQgMCwwIHNvIHdlIGhhdmUgdG8gcG9zaXRpb24gaXRcbiAgICB0aGlzLnBvbHlnb24gPSB0cmFuc2xhdGUodGlsZWRPYmoueCwgdGlsZWRPYmoueSwgdGlsZWRPYmoucG9seWdvbik7XG4gICAgdGhpcy5pbmNsdWRlc1BvaW50ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gaW5zaWRlKFt4LCB5XSwgdGhpcy5wb2x5Z29uKTtcbiAgICB9O1xufTtcblxudmFyIHRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHgsIHksIHBvbHlnb24pIHtcbiAgICB2YXIgcG9seSA9IHBvbHlnb24uc2xpY2UoMCk7XG5cdGZvcihpIGluIHBvbHkpIHtcblx0XHR2YXIgdmVydGV4ID0gcG9seVtpXTtcblx0XHR2ZXJ0ZXhbMF0gKz0geDtcblx0XHR2ZXJ0ZXhbMV0gKz0geTtcblx0fTtcbiAgICByZXR1cm4gcG9seTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUG9seWdvbjtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoMTAyNCwgNzY4LCBQaGFzZXIuQVVUTywgJ3NhZ2RjLWdhbWUnKTtcblxud2luZG93LlV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIFVVSUQ6ICcnLFxuICAgIGludmVudG9yeTogW10sIC8vIExpc3Qgb2YgSXRlbVxuICAgIGN1cnJlbnRseUVxdWlwcGVkOiBudWxsLCAvLyBJdGVtXG4gICAgY3VycmVudExldmVsOiAnQmx1ZVJvb20nXG59XG5cbmlmIChVdGlscy5sb2NhbFN0b3JhZ2VTdXBwb3J0ZWQoKSkge1xuICAgICBpZiAobG9jYWxTdG9yYWdlWydwbGF5ZXJTdGF0ZSddICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcGxheWVyU3RhdGUgPSBVdGlscy5nZXRPYmplY3QoJ3BsYXllclN0YXRlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcGxheWVyU3RhdGUuVVVJRCA9IFV0aWxzLmdlbmVyYXRlVVVJRCgpOyAgIFxuICAgICAgICBVdGlscy5zZXRPYmplY3QoJ3BsYXllclN0YXRlJywgcGxheWVyU3RhdGUpO1xuICAgIH1cbn0gZWxzZSB7XG4gICAgYWxlcnQoXCJMb2NhbCBzdG9yYWdlIG5vdCBzdXBwb3J0ZWQgLSB5b3UgY2Fubm90IHNhdmUhXCIpO1xufVxuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcbmdhbWUuc3RhdGUuYWRkKCdCbHVlUm9vbScsIHJlcXVpcmUoJy4vc3RhdGVzL2JsdWVfdGVzdF9yb29tJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1JlZFJvb20nLCByZXF1aXJlKCcuL3N0YXRlcy9yZWRfdGVzdF9yb29tJykpO1xuXG5nYW1lLnN0YXRlLnN0YXJ0KCdCb290Jyk7XG4iLCJ2YXIgR2FtZVNjcmVlbiA9IHJlcXVpcmUoJy4uL3N0YXRlcy9nYW1lX3NjcmVlbicpO1xuXG52YXIgQmx1ZVJvb20gPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5tYXAgPSBudWxsO1xufTtcblxuQmx1ZVJvb20ucHJvdG90eXBlID0gbmV3IEdhbWVTY3JlZW4oKTtcbkJsdWVSb29tLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcblx0cGxheWVyU3RhdGUuY3VycmVudExldmVsID0gJ0JsdWVSb29tJztcblxuXHR2YXIgYmcgPSB0aGlzLmdhbWUuYWRkLmltYWdlKDAsIDAsICdibHVlX3Jvb20nKTtcblxuXHR0aGlzLm1hcCA9IHRoaXMuZ2FtZS5hZGQudGlsZW1hcCgnYmx1ZV9yb29tJyk7XG5cdHZhciBtYXBCZyA9IHRoaXMubWFwLmNyZWF0ZUxheWVyKCdiZycpO1xuXG5cdHRoaXMuaW5pdFNjcmVlbigpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCbHVlUm9vbTtcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge307XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vdDtcblxuQm9vdC5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyJywgJ2Fzc2V0cy9wcmVsb2FkZXIuZ2lmJyk7XG4gIH0sXG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLmlucHV0Lm1heFBvaW50ZXJzID0gMTtcblxuICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGVNb2RlID0gUGhhc2VyLlN0YWdlU2NhbGVNb2RlLlNIT1dfQUxMO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1pbldpZHRoID0gIDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWF4V2lkdGggPSA2NDA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWF4SGVpZ2h0ID0gNDgwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgfVxufTtcbiIsInZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9wbGF5ZXInKTtcblxudmFyIEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGVzdGVudGl0eSA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4ID0gKHRoaXMuZ2FtZS53aWR0aCAvIDIpIC0gMTAwO1xuICAgIHZhciB5ID0gKHRoaXMuZ2FtZS5oZWlnaHQgLyAyKSAtIDUwO1xuXG4gICAgdGhpcy50ZXN0ZW50aXR5ID0gbmV3IFBsYXllcih0aGlzLmdhbWUsIHgsIHkpO1xuICAgIHRoaXMudGVzdGVudGl0eS5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25JbnB1dERvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4LCB5LCBjeCwgY3ksIGR4LCBkeSwgYW5nbGUsIHNjYWxlO1xuXG4gICAgeCA9IHRoaXMuaW5wdXQucG9zaXRpb24ueDtcbiAgICB5ID0gdGhpcy5pbnB1dC5wb3NpdGlvbi55O1xuICAgIGN4ID0gdGhpcy53b3JsZC5jZW50ZXJYO1xuICAgIGN5ID0gdGhpcy53b3JsZC5jZW50ZXJZO1xuXG4gICAgYW5nbGUgPSBNYXRoLmF0YW4yKHkgLSBjeSwgeCAtIGN4KSAqICgxODAgLyBNYXRoLlBJKTtcbiAgICB0aGlzLnRlc3RlbnRpdHkuYW5nbGUgPSBhbmdsZTtcblxuICAgIGR4ID0geCAtIGN4O1xuICAgIGR5ID0geSAtIGN5O1xuICAgIHNjYWxlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KSAvIDEwMDtcblxuICAgIHRoaXMudGVzdGVudGl0eS5zY2FsZS54ID0gc2NhbGUgKiAwLjY7XG4gICAgdGhpcy50ZXN0ZW50aXR5LnNjYWxlLnkgPSBzY2FsZSAqIDAuNjtcbiAgfSxcblxuICBvbklucHV0RG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICB9XG59O1xuIiwiLy9tYWluIGdhbWUgc2NyZWVuIHRoYXQgdGhlIHZhcmlvdXMgc2NlbmVzIHdpbGwgaW5oZXJpdFxuXG52YXIgUGxheWVyID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvcGxheWVyJyk7XG52YXIgQ2xpY2thYmxlID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvY2xpY2thYmxlJyk7XG5cbnZhciBHYW1lU2NyZWVuID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMucGxheWVyID0gbnVsbDtcbn07XG5cbkdhbWVTY3JlZW4ucHJvdG90eXBlID0ge1xuICBpbml0U2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnBvaW50cyA9IGV4dHJhY3RQb2ludHNGcm9tVGlsZU1hcExheWVyKHRoaXMubWFwLm9iamVjdHMucG9pbnRzKTtcbiAgICB0aGlzLmNsaWNrYWJsZXMgPSBleHRyYWN0Q2xpY2thYmxlc0Zyb21UaWxlTWFwTGF5ZXIodGhpcy5tYXAub2JqZWN0cy5jbGlja2FibGVfcG9seWdvbnMpO1xuXG4gICAgdmFyIHggPSAodGhpcy5nYW1lLndpZHRoIC8gMik7XG4gICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpICsgMjUwO1xuXG4gICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgeCwgeSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbklucHV0RG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH0sXG5cbiAgb25JbnB1dERvd246IGZ1bmN0aW9uIChjdXJzb3IpIHtcbiAgICB2YXIgeCA9IGN1cnNvci54LFxuICAgICAgICAgeSA9IGN1cnNvci55O1xuXG4gICAgZm9yKGkgaW4gdGhpcy5jbGlja2FibGVzKSB7XG4gICAgICAgIHZhciBjbGlja2FibGUgPSB0aGlzLmNsaWNrYWJsZXNbaV07XG4gICAgICAgIGlmKGNsaWNrYWJsZS5pbmNsdWRlc1BvaW50KHgsIHkpKSB7XG4gICAgICAgICAgICBpZihjbGlja2FibGUubmFtZSA9PSAnZmxvb3InKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLm1vdmVUbyh4LCB5KTtcdFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoY2xpY2thYmxlLm5hbWUgPT0gJ2Rvb3InKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLm1vdmVUbyh4LCB0aGlzLnBsYXllci55LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRSb29tID0gKHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCA9PSAnQmx1ZVJvb20nKSA/ICdSZWRSb29tJyA6ICdCbHVlUm9vbSc7IFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQobmV4dFJvb20pO1xuICAgICAgICAgICAgICAgIH0pO1x0XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbnZhciBleHRyYWN0UG9pbnRzRnJvbVRpbGVNYXBMYXllciA9IGZ1bmN0aW9uKGxheWVyKSB7XG5cdHZhciBwb2ludHMgPSBbXTtcblx0Zm9yKGkgaW4gbGF5ZXIpIHtcblx0XHRwb2ludHMucHVzaChsYXllcltpXSk7XG5cdH1cblx0cmV0dXJuIHBvaW50cztcbn07XG5cbnZhciBleHRyYWN0Q2xpY2thYmxlc0Zyb21UaWxlTWFwTGF5ZXIgPSBmdW5jdGlvbihsYXllcikge1xuXHR2YXIgY2xpY2thYmxlcyA9IFtdO1xuXHRmb3IoaSBpbiBsYXllcikge1xuXHRcdGNsaWNrYWJsZXMucHVzaChDbGlja2FibGUuY3JlYXRlKGxheWVyW2ldKSk7XG5cdH1cblx0cmV0dXJuIGNsaWNrYWJsZXM7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVTY3JlZW47XG4iLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXh0ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTtcblxuTWVudS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgIHZhciB5ID0gdGhpcy5nYW1lLmhlaWdodCAvIDI7XG5cbiAgICB2YXIgc3R5bGUgPSB7IGZvbnQ6IFwiNjVweCBBcmlhbFwiLCBmaWxsOiBcIiNmZmZmZmZcIiwgYWxpZ246IFwiY2VudGVyXCIgfTtcblxuICAgIHRoaXMudGV4dCA9IHRoaXMuYWRkLnRleHQoeCAtIDMwMCwgeSAtIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICB9LFxuXG4gIG9uRG93bjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgIHRoaXMuYXNzZXQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgndGVzdHNwcml0ZScsICdhc3NldHMvdGVzdC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2hhcHB5LW1hbicsICdhc3NldHMvaGFwcHktbWFuLnBuZycpO1xuICAgIHRoaXMubG9hZC50aWxlbWFwKCdibHVlX3Jvb20nLCAnYXNzZXRzL3RpbGVtYXBzL2JsdWVfcm9vbS5qc29uJywgbnVsbCwgUGhhc2VyLlRpbGVtYXAuVElMRURfSlNPTik7XG4gICAgdGhpcy5sb2FkLnRpbGVtYXAoJ3JlZF9yb29tJywgJ2Fzc2V0cy90aWxlbWFwcy9yZWRfcm9vbS5qc29uJywgbnVsbCwgUGhhc2VyLlRpbGVtYXAuVElMRURfSlNPTik7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdibHVlX3Jvb20nLCAnYXNzZXRzL3Rlc3RfYmdfYmx1ZS5qcGcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3JlZF9yb29tJywgJ2Fzc2V0cy90ZXN0X2JnX3JlZC5qcGcnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmFzc2V0LmNyb3BFbmFibGVkID0gZmFsc2U7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEhdGhpcy5yZWFkeSkge1xuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gICAgfVxuICB9LFxuXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH1cbn07XG4iLCJ2YXIgR2FtZVNjcmVlbiA9IHJlcXVpcmUoJy4uL3N0YXRlcy9nYW1lX3NjcmVlbicpO1xuXG52YXIgUmVkUm9vbSA9IGZ1bmN0aW9uKCkge1xuXHR0aGlzLm1hcCA9IG51bGw7XG59O1xuXG5SZWRSb29tLnByb3RvdHlwZSA9IG5ldyBHYW1lU2NyZWVuKCk7XG5SZWRSb29tLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcblx0cGxheWVyU3RhdGUuY3VycmVudExldmVsID0gJ1JlZFJvb20nO1xuXG5cdHZhciBiZyA9IHRoaXMuZ2FtZS5hZGQuaW1hZ2UoMCwgMCwgJ3JlZF9yb29tJyk7XG5cblx0dGhpcy5tYXAgPSB0aGlzLmdhbWUuYWRkLnRpbGVtYXAoJ3JlZF9yb29tJyk7XG5cblx0dGhpcy5pbml0U2NyZWVuKCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlZFJvb207XG4iLCJ2YXIgU3BsYXNoID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTcGxhc2g7XG5cblNwbGFzaC5wcm90b3R5cGUgPSB7XG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICB9XG59OyIsInZhciBVdGlscyA9IHtcbiAgICBjb250YWluc09iamVjdDogZnVuY3Rpb24ob2JqLCBsaXN0KSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBsb2NhbFN0b3JhZ2VTdXBwb3J0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuICdsb2NhbFN0b3JhZ2UnIGluIHdpbmRvdyAmJiB3aW5kb3dbJ2xvY2FsU3RvcmFnZSddICE9PSBudWxsO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2VuZXJhdGVVVUlEOiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgZCA9IERhdGUubm93KCk7XG4gICAgICAgIHZhciB1dWlkID0gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSoxNiklMTYgfCAwO1xuICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZC8xNik7XG4gICAgICAgICAgICByZXR1cm4gKGM9PSd4JyA/IHIgOiAociYweDd8MHg4KSkudG9TdHJpbmcoMTYpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHV1aWQ7XG4gICAgfSxcblxuICAgIGdldE9iamVjdDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICByZXR1cm4gdmFsdWUgJiYgSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgfSxcblxuICAgIHNldE9iamVjdDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgfSxcblxuICAgIGV4dGVuZDogZnVuY3Rpb24gKHRhcmdldCwgb3RoZXIpIHtcbiAgICAgIGZvciAodmFyIHByb3AgaW4gb3RoZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvdGhlcltwcm9wXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICB0YXJnZXRbcHJvcF0gPSBleHRlbmQodGFyZ2V0W3Byb3BdLCBvdGhlcltwcm9wXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFyZ2V0W3Byb3BdID0gb3RoZXJbcHJvcF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlscztcbiJdfQ==
