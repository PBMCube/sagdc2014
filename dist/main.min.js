(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = function (point, vs) {
    // ray-casting algorithm based on
    // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
};

},{}],2:[function(require,module,exports){
//This is for making useful objects out of tiled objects

var ClickablePolygon = require('./clickable_polygon');
var ClickableSprite = require('./clickable_sprite');
var Utils = require('../utils');

var Clickable = function(game, tiledObj) {
    if(tiledObj.polygon) {
        ClickablePolygon.call(this, game, tiledObj)
    } else {
        ClickableSprite.call(this, game, tiledObj)
    }

    this.name = tiledObj.name;

    Utils.extend(this, tiledObj.properties);
}

Clickable.prototype.click = function(cursor, state) {
    try {
        this.onClick(cursor, state);
    } catch(err) {
        console.log(this.name, 'onClick');
    }
};

Clickable.prototype.onClick = function(options) {
    throw 'not implemented'
};

module.exports = Clickable;

},{"../utils":20,"./clickable_polygon":4,"./clickable_sprite":5}],3:[function(require,module,exports){
/*
This serves as a registry so the game_screen can automatically make objects
out of what it finds in the Tiled maps.
*/

var clickables = {
    Door: require('./door'),
    Floor: require('./floor'),
    LightSwitch: require('./light_switch'),
};

module.exports.create = function(game, tiledObj) {
    try {
        if(!tiledObj.properties.class) { tiledObj.properties.class = tiledObj.name; }
        var klass = tiledObj.properties.class;
        if(clickables[klass]) {
            return new clickables[klass](game, tiledObj);
        } else {
            throw 'clickable undefined';
        }
    } catch(err) {
        console.log(err + ': ', tiledObj.name);
        return undefined;
    }
};

},{"./door":7,"./floor":8,"./light_switch":9}],4:[function(require,module,exports){
//This is a mixin for making useful objects from tiled polygons

var inside = require('point-in-polygon');

Polygon = function(game, tiledObj) {
    //The polygon is stored with the first point at 0,0 so we have to position it
    this.polygon = translate(tiledObj.x, tiledObj.y, tiledObj.polygon);
    this.includesPoint = function(x, y) {
        return inside([x, y], this.polygon);
    };
};

var translate = function(x, y, polygon) {
    var poly = polygon.slice(0);
	for(i in poly) {
		var vertex = poly[i];
		vertex[0] += x;
		vertex[1] += y;
	};
    return poly;
};

module.exports = Polygon;

},{"point-in-polygon":1}],5:[function(require,module,exports){
//This is a mixin for making Phaser sprites from Tiled objects

var Utils = require('../utils');

var ClickableSprite = function(game, tiledObj) {
    this.x = tiledObj.x;
    this.y = tiledObj.y;

    Utils.extend(this, Object.create(Phaser.Sprite.prototype));
	Phaser.Sprite.call(this, game, tiledObj.x, tiledObj.y, 'light_switch');
	game.add.existing(this);

    var bounds = this.getBounds();
    bounds.offset(this.x, this.y);
    this.includesPoint = function(x, y) {
        return (
            x >= bounds.x &&
            x <= bounds.x + bounds.width &&
            y >= bounds.y &&
            y <= bounds.y + bounds.height
        )
    };
    this.update = function() {};
};

module.exports = ClickableSprite;

},{"../utils":20}],6:[function(require,module,exports){

CursorText = function(game) {
    this.cursor = game.input.mousePointer;
    this.offset = 20;

    var style = { 
        font: "17px Arial",
        fill: "#fff",
        align: "center",
        strokeThickness: 2
    };
    this.text = game.add.text(this.cursor.x, this.cursor.y, '', style);
    this.text.update = updatePosition(this.cursor, this.offset);
    this.timer = game.time.create(false);
}


CursorText.prototype.startMessage = function(message, time) {
    time = time || 1000;
    this.text.text = message;
    if (this.timer.running) {
        this.timer.stop();
    }
    this.timer.add(time, this.endMessage, this);
    this.timer.start();
};
CursorText.prototype.endMessage = function() {
    this.text.text = '';
    this.timer.stop();
};
var updatePosition = function(cursor, offset) {
   return function() {
       this.position.x = cursor.x + offset;
       this.position.y = cursor.y - offset;
   }
};


module.exports = CursorText;


},{}],7:[function(require,module,exports){
Clickable = require('./clickable');

Door = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
Door.prototype = Object.create(Clickable.prototype);

Door.prototype.onClick = function(cursor, state) {
    var target = state.points[this.target];
    state.player.moveTo(target.x, target.y, function() {
        if(target.properties.nextSpawnPoint) {
            playerState.spawnPoint = target.properties.nextSpawnPoint;
        }
        state.game.state.start(target.properties.destination);
    });	
}

module.exports = Door;

},{"./clickable":2}],8:[function(require,module,exports){
Clickable = require('./clickable');

Floor = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
Floor.prototype = Object.create(Clickable.prototype);

Floor.prototype.onClick = function(cursor, state) {
    state.player.moveTo(cursor.x, cursor.y);	
}

module.exports = Floor;

},{"./clickable":2}],9:[function(require,module,exports){
Clickable = require('./clickable');

LightSwitch = function(game, tiledObj) {
    Clickable.call(this, game, tiledObj);
}
LightSwitch.prototype = Object.create(Clickable.prototype);

LightSwitch.prototype.onClick = function(cursor, state) {
    console.log('LIGHT SWITCH');
    image.events.onInputOver.add(over, this);
    image.events.onInputOut.add(out, this);
}

module.exports = LightSwitch;

},{"./clickable":2}],10:[function(require,module,exports){
var Player = function (game, x, y) {
	Phaser.Sprite.call(this, game, x, y, 'happy-man');
	game.add.existing(this);

	this.movement;
	this.anchor.setTo(0.5, 0.95);
		
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function() {
};

Player.prototype.moveTo = function(x, y, done) {
	if (this.movement && this.movement.isRunning) {
		this.movement.stop();
	}

	var duration = (this.game.physics.arcade.distanceToXY(this, x, y) / 300) * 1000;
	this.movement = this.game.add.tween(this)
		.to({ x: x, y: y }, duration, Phaser.Easing.Linear.None, true);
	if(done) {
		this.movement.onComplete.add(done, this);
	}
};

module.exports = Player;

},{}],11:[function(require,module,exports){
'use strict';

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'sagdc-game');

window.Utils = require('./utils');
window.playerState = {
    UUID: '',
    inventory: [], // List of Item
    currentlyEquipped: null, // Item
    currentLevel: 'BlueRoom'
}

if (Utils.localStorageSupported()) {
     if (localStorage['playerState'] !== undefined) {
        playerState = Utils.getObject('playerState');
    } else {
        playerState.UUID = Utils.generateUUID();   
        Utils.setObject('playerState', playerState);
    }
} else {
    alert("Local storage not supported - you cannot save!");
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('BlueRoom', require('./states/blue_test_room'));
game.state.add('RedRoom', require('./states/red_test_room'));

game.state.start('Boot');

},{"./states/blue_test_room":12,"./states/boot":13,"./states/game":14,"./states/menu":16,"./states/preloader":17,"./states/red_test_room":18,"./states/splash":19,"./utils":20}],12:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var BlueRoom = function() {
    this.map = null;
};

BlueRoom.prototype = new GameScreen();
BlueRoom.prototype.create = function() {
    playerState.currentLevel = 'BlueRoom';

    var bg = this.game.add.image(0, 0, 'blue_room');

    this.map = this.game.add.tilemap('blue_room');

    this.initScreen();

    //overriding the default behavior of the lightSwitch
    this.clickables.lightSwitch.onClick = function(cursor, state){
        var player = state.player;
        player.moveTo(this.x, this.y + (player.height / 2), function() {
            console.log('LIGHTS OUT, MOTHERFUCKER');
        });
    };
};

module.exports = BlueRoom;

},{"../states/game_screen":15}],13:[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function () {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.stage.scale.pageAlignHorizontally = true;
    } else {
      this.game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      this.game.stage.scale.minWidth =  480;
      this.game.stage.scale.minHeight = 260;
      this.game.stage.scale.maxWidth = 640;
      this.game.stage.scale.maxHeight = 480;
      this.game.stage.scale.forceLandscape = true;
      this.game.stage.scale.pageAlignHorizontally = true;
      this.game.stage.scale.setScreenSize(true);
    }

    this.game.state.start('Preloader');
  }
};

},{}],14:[function(require,module,exports){
var Player = require('../entities/player');

var Game = function () {
  this.testentity = null;
};

module.exports = Game;

Game.prototype = {

  create: function () {
    var x = (this.game.width / 2) - 100;
    var y = (this.game.height / 2) - 50;

    this.testentity = new Player(this.game, x, y);
    this.testentity.anchor.setTo(0.5, 0.5);

    this.input.onDown.add(this.onInputDown, this);
  },

  update: function () {
    var x, y, cx, cy, dx, dy, angle, scale;

    x = this.input.position.x;
    y = this.input.position.y;
    cx = this.world.centerX;
    cy = this.world.centerY;

    angle = Math.atan2(y - cy, x - cx) * (180 / Math.PI);
    this.testentity.angle = angle;

    dx = x - cx;
    dy = y - cy;
    scale = Math.sqrt(dx * dx + dy * dy) / 100;

    this.testentity.scale.x = scale * 0.6;
    this.testentity.scale.y = scale * 0.6;
  },

  onInputDown: function () {
    this.game.state.start('Menu');
  }
};

},{"../entities/player":10}],15:[function(require,module,exports){
//main game screen that the various scenes will inherit

var Player = require('../entities/player');
var ClickableMaker = require('../entities/clickable_maker');
var CursorText = require('../entities/cursor_text');

var GameScreen = function() {
    this.player = null;
};

GameScreen.prototype = {
    initScreen: function() {
        this.points = this.extractPointsFromTileMapLayer(this.map.objects.points);
        this.clickables = this.extractClickablesFromTileMapLayer(this.map.objects.clickables);

        this.cursorText = new CursorText(this.game);

        if(playerState.spawnPoint && this.points[playerState.spawnPoint]) {
            var point = this.points[playerState.spawnPoint];
            var x = point.x;
            var y = point.y;
        } else {
            var x = (this.game.width / 2);
            var y = (this.game.height / 2) + 250;
        }
        this.player = new Player(this.game, x, y);

        this.input.onDown.add(this.clickClickables, this);
    },

    update: function () {
    },

    clickClickables: function(cursor) {
        for(i in this.clickables) {
            var clickable = this.clickables[i];
            if(clickable.includesPoint(cursor.x, cursor.y)) {
                clickable.click(cursor, this);
            }
        }
    },

    extractPointsFromTileMapLayer: function(layer) {
        var points = {};
        for(i in layer) {
            point = layer[i];
            points[point.name] = point;
        }
        return points;
    },

    extractClickablesFromTileMapLayer: function(layer) {
        var clickables = {};
        for(i in layer) {
            var clickable = ClickableMaker.create(this.game, layer[i]);
            if(clickable) { clickables[clickable.name] = clickable; }
        }
        return clickables;
    },

    update: function() {
        for(i in this.clickables) {
            var clickable = this.clickables[i];
            
            checkClickableHover(clickable, this.game.input.mousePointer, this.cursorText);
        }
    }
};

var checkClickableHover = function(clickable, cursor, cursorText) {
    if(clickable.hoverText && clickable.includesPoint(cursor.x, cursor.y)) {
        cursorText.startMessage(clickable.hoverText); 
    }
};

module.exports = GameScreen;

},{"../entities/clickable_maker":3,"../entities/cursor_text":6,"../entities/player":10}],16:[function(require,module,exports){
var Menu = function () {
  this.text = null;
};

module.exports = Menu;

Menu.prototype = {

  create: function () {
    var x = this.game.width / 2;
    var y = this.game.height / 2;

    var style = { font: "65px Arial", fill: "#ffffff", align: "center" };

    this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

    this.input.onDown.add(this.onDown, this);
  },

  update: function () {
  },

  onDown: function () {
    this.game.state.start(playerState.currentLevel);
  }
};

},{}],17:[function(require,module,exports){
var Preloader = function (game) {
  this.asset = null;
  this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(320, 240, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    this.load.image('testsprite', 'assets/test.png');
    this.load.image('happy-man', 'assets/happy-man.png');
    this.load.tilemap('blue_room', 'assets/tilemaps/blue_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.tilemap('red_room', 'assets/tilemaps/red_room.json', null, Phaser.Tilemap.TILED_JSON);
    this.load.image('blue_room', 'assets/test_bg_blue.jpg');
    this.load.image('red_room', 'assets/test_bg_red.jpg');
    this.load.spritesheet('light_switch', 'assets/light_switch.png', 32, 32);
  },

  create: function () {
    this.asset.cropEnabled = false;
  },

  update: function () {
    if (!!this.ready) {
      this.game.state.start('Menu');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

},{}],18:[function(require,module,exports){
var GameScreen = require('../states/game_screen');

var RedRoom = function() {
	this.map = null;
};

RedRoom.prototype = new GameScreen();
RedRoom.prototype.create = function() {
	playerState.currentLevel = 'RedRoom';

	var bg = this.game.add.image(0, 0, 'red_room');

	this.map = this.game.add.tilemap('red_room');

	this.initScreen();
};

module.exports = RedRoom;

},{"../states/game_screen":15}],19:[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
  create: function () {
  }
};
},{}],20:[function(require,module,exports){
var Utils = {
    containsObject: function(obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    localStorageSupported: function() {
        try {
            return 'localStorage' in window && window['localStorage'] !== null;
        } catch (e) {
            return false;
        }
    },

    generateUUID: function(){
        var d = Date.now();
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = (d + Math.random()*16)%16 | 0;
            d = Math.floor(d/16);
            return (c=='x' ? r : (r&0x7|0x8)).toString(16);
        });
        return uuid;
    },

    getObject: function(key, value) {
        var value = localStorage.getItem(key);
        return value && JSON.parse(value);
    },

    setObject: function(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    },

    extend: function (target, other) {
      for (var prop in other) {
        if (typeof other[prop] === 'object') {
          target[prop] = extend(target[prop], other[prop]);
        } else {
          target[prop] = other[prop];
        }
      }
      return target;
    }
};

module.exports = Utils;

},{}]},{},[11])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlcyI6WyIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L25vZGVfbW9kdWxlcy9wb2ludC1pbi1wb2x5Z29uL2luZGV4LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlX21ha2VyLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY2xpY2thYmxlX3BvbHlnb24uanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9jbGlja2FibGVfc3ByaXRlLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvY3Vyc29yX3RleHQuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9kb29yLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvZW50aXRpZXMvZmxvb3IuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9saWdodF9zd2l0Y2guanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9lbnRpdGllcy9wbGF5ZXIuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9tYWluLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2JsdWVfdGVzdF9yb29tLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL2Jvb3QuanMiLCIvaG9tZS9ib3Jlbi9zcmMvc2FnZGMyMDE0L3NyYy9qcy9zdGF0ZXMvZ2FtZS5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9nYW1lX3NjcmVlbi5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9tZW51LmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL3ByZWxvYWRlci5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3N0YXRlcy9yZWRfdGVzdF9yb29tLmpzIiwiL2hvbWUvYm9yZW4vc3JjL3NhZ2RjMjAxNC9zcmMvanMvc3RhdGVzL3NwbGFzaC5qcyIsIi9ob21lL2JvcmVuL3NyYy9zYWdkYzIwMTQvc3JjL2pzL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAocG9pbnQsIHZzKSB7XG4gICAgLy8gcmF5LWNhc3RpbmcgYWxnb3JpdGhtIGJhc2VkIG9uXG4gICAgLy8gaHR0cDovL3d3dy5lY3NlLnJwaS5lZHUvSG9tZXBhZ2VzL3dyZi9SZXNlYXJjaC9TaG9ydF9Ob3Rlcy9wbnBvbHkuaHRtbFxuICAgIFxuICAgIHZhciB4ID0gcG9pbnRbMF0sIHkgPSBwb2ludFsxXTtcbiAgICBcbiAgICB2YXIgaW5zaWRlID0gZmFsc2U7XG4gICAgZm9yICh2YXIgaSA9IDAsIGogPSB2cy5sZW5ndGggLSAxOyBpIDwgdnMubGVuZ3RoOyBqID0gaSsrKSB7XG4gICAgICAgIHZhciB4aSA9IHZzW2ldWzBdLCB5aSA9IHZzW2ldWzFdO1xuICAgICAgICB2YXIgeGogPSB2c1tqXVswXSwgeWogPSB2c1tqXVsxXTtcbiAgICAgICAgXG4gICAgICAgIHZhciBpbnRlcnNlY3QgPSAoKHlpID4geSkgIT0gKHlqID4geSkpXG4gICAgICAgICAgICAmJiAoeCA8ICh4aiAtIHhpKSAqICh5IC0geWkpIC8gKHlqIC0geWkpICsgeGkpO1xuICAgICAgICBpZiAoaW50ZXJzZWN0KSBpbnNpZGUgPSAhaW5zaWRlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gaW5zaWRlO1xufTtcbiIsIi8vVGhpcyBpcyBmb3IgbWFraW5nIHVzZWZ1bCBvYmplY3RzIG91dCBvZiB0aWxlZCBvYmplY3RzXG5cbnZhciBDbGlja2FibGVQb2x5Z29uID0gcmVxdWlyZSgnLi9jbGlja2FibGVfcG9seWdvbicpO1xudmFyIENsaWNrYWJsZVNwcml0ZSA9IHJlcXVpcmUoJy4vY2xpY2thYmxlX3Nwcml0ZScpO1xudmFyIFV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMnKTtcblxudmFyIENsaWNrYWJsZSA9IGZ1bmN0aW9uKGdhbWUsIHRpbGVkT2JqKSB7XG4gICAgaWYodGlsZWRPYmoucG9seWdvbikge1xuICAgICAgICBDbGlja2FibGVQb2x5Z29uLmNhbGwodGhpcywgZ2FtZSwgdGlsZWRPYmopXG4gICAgfSBlbHNlIHtcbiAgICAgICAgQ2xpY2thYmxlU3ByaXRlLmNhbGwodGhpcywgZ2FtZSwgdGlsZWRPYmopXG4gICAgfVxuXG4gICAgdGhpcy5uYW1lID0gdGlsZWRPYmoubmFtZTtcblxuICAgIFV0aWxzLmV4dGVuZCh0aGlzLCB0aWxlZE9iai5wcm9wZXJ0aWVzKTtcbn1cblxuQ2xpY2thYmxlLnByb3RvdHlwZS5jbGljayA9IGZ1bmN0aW9uKGN1cnNvciwgc3RhdGUpIHtcbiAgICB0cnkge1xuICAgICAgICB0aGlzLm9uQ2xpY2soY3Vyc29yLCBzdGF0ZSk7XG4gICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5uYW1lLCAnb25DbGljaycpO1xuICAgIH1cbn07XG5cbkNsaWNrYWJsZS5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB0aHJvdyAnbm90IGltcGxlbWVudGVkJ1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDbGlja2FibGU7XG4iLCIvKlxuVGhpcyBzZXJ2ZXMgYXMgYSByZWdpc3RyeSBzbyB0aGUgZ2FtZV9zY3JlZW4gY2FuIGF1dG9tYXRpY2FsbHkgbWFrZSBvYmplY3RzXG5vdXQgb2Ygd2hhdCBpdCBmaW5kcyBpbiB0aGUgVGlsZWQgbWFwcy5cbiovXG5cbnZhciBjbGlja2FibGVzID0ge1xuICAgIERvb3I6IHJlcXVpcmUoJy4vZG9vcicpLFxuICAgIEZsb29yOiByZXF1aXJlKCcuL2Zsb29yJyksXG4gICAgTGlnaHRTd2l0Y2g6IHJlcXVpcmUoJy4vbGlnaHRfc3dpdGNoJyksXG59O1xuXG5tb2R1bGUuZXhwb3J0cy5jcmVhdGUgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIHRyeSB7XG4gICAgICAgIGlmKCF0aWxlZE9iai5wcm9wZXJ0aWVzLmNsYXNzKSB7IHRpbGVkT2JqLnByb3BlcnRpZXMuY2xhc3MgPSB0aWxlZE9iai5uYW1lOyB9XG4gICAgICAgIHZhciBrbGFzcyA9IHRpbGVkT2JqLnByb3BlcnRpZXMuY2xhc3M7XG4gICAgICAgIGlmKGNsaWNrYWJsZXNba2xhc3NdKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGNsaWNrYWJsZXNba2xhc3NdKGdhbWUsIHRpbGVkT2JqKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93ICdjbGlja2FibGUgdW5kZWZpbmVkJztcbiAgICAgICAgfVxuICAgIH0gY2F0Y2goZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVyciArICc6ICcsIHRpbGVkT2JqLm5hbWUpO1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbn07XG4iLCIvL1RoaXMgaXMgYSBtaXhpbiBmb3IgbWFraW5nIHVzZWZ1bCBvYmplY3RzIGZyb20gdGlsZWQgcG9seWdvbnNcblxudmFyIGluc2lkZSA9IHJlcXVpcmUoJ3BvaW50LWluLXBvbHlnb24nKTtcblxuUG9seWdvbiA9IGZ1bmN0aW9uKGdhbWUsIHRpbGVkT2JqKSB7XG4gICAgLy9UaGUgcG9seWdvbiBpcyBzdG9yZWQgd2l0aCB0aGUgZmlyc3QgcG9pbnQgYXQgMCwwIHNvIHdlIGhhdmUgdG8gcG9zaXRpb24gaXRcbiAgICB0aGlzLnBvbHlnb24gPSB0cmFuc2xhdGUodGlsZWRPYmoueCwgdGlsZWRPYmoueSwgdGlsZWRPYmoucG9seWdvbik7XG4gICAgdGhpcy5pbmNsdWRlc1BvaW50ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gaW5zaWRlKFt4LCB5XSwgdGhpcy5wb2x5Z29uKTtcbiAgICB9O1xufTtcblxudmFyIHRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHgsIHksIHBvbHlnb24pIHtcbiAgICB2YXIgcG9seSA9IHBvbHlnb24uc2xpY2UoMCk7XG5cdGZvcihpIGluIHBvbHkpIHtcblx0XHR2YXIgdmVydGV4ID0gcG9seVtpXTtcblx0XHR2ZXJ0ZXhbMF0gKz0geDtcblx0XHR2ZXJ0ZXhbMV0gKz0geTtcblx0fTtcbiAgICByZXR1cm4gcG9seTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUG9seWdvbjtcbiIsIi8vVGhpcyBpcyBhIG1peGluIGZvciBtYWtpbmcgUGhhc2VyIHNwcml0ZXMgZnJvbSBUaWxlZCBvYmplY3RzXG5cbnZhciBVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG5cbnZhciBDbGlja2FibGVTcHJpdGUgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIHRoaXMueCA9IHRpbGVkT2JqLng7XG4gICAgdGhpcy55ID0gdGlsZWRPYmoueTtcblxuICAgIFV0aWxzLmV4dGVuZCh0aGlzLCBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKSk7XG5cdFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB0aWxlZE9iai54LCB0aWxlZE9iai55LCAnbGlnaHRfc3dpdGNoJyk7XG5cdGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xuXG4gICAgdmFyIGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKCk7XG4gICAgYm91bmRzLm9mZnNldCh0aGlzLngsIHRoaXMueSk7XG4gICAgdGhpcy5pbmNsdWRlc1BvaW50ID0gZnVuY3Rpb24oeCwgeSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgeCA+PSBib3VuZHMueCAmJlxuICAgICAgICAgICAgeCA8PSBib3VuZHMueCArIGJvdW5kcy53aWR0aCAmJlxuICAgICAgICAgICAgeSA+PSBib3VuZHMueSAmJlxuICAgICAgICAgICAgeSA8PSBib3VuZHMueSArIGJvdW5kcy5oZWlnaHRcbiAgICAgICAgKVxuICAgIH07XG4gICAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbigpIHt9O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBDbGlja2FibGVTcHJpdGU7XG4iLCJcbkN1cnNvclRleHQgPSBmdW5jdGlvbihnYW1lKSB7XG4gICAgdGhpcy5jdXJzb3IgPSBnYW1lLmlucHV0Lm1vdXNlUG9pbnRlcjtcbiAgICB0aGlzLm9mZnNldCA9IDIwO1xuXG4gICAgdmFyIHN0eWxlID0geyBcbiAgICAgICAgZm9udDogXCIxN3B4IEFyaWFsXCIsXG4gICAgICAgIGZpbGw6IFwiI2ZmZlwiLFxuICAgICAgICBhbGlnbjogXCJjZW50ZXJcIixcbiAgICAgICAgc3Ryb2tlVGhpY2tuZXNzOiAyXG4gICAgfTtcbiAgICB0aGlzLnRleHQgPSBnYW1lLmFkZC50ZXh0KHRoaXMuY3Vyc29yLngsIHRoaXMuY3Vyc29yLnksICcnLCBzdHlsZSk7XG4gICAgdGhpcy50ZXh0LnVwZGF0ZSA9IHVwZGF0ZVBvc2l0aW9uKHRoaXMuY3Vyc29yLCB0aGlzLm9mZnNldCk7XG4gICAgdGhpcy50aW1lciA9IGdhbWUudGltZS5jcmVhdGUoZmFsc2UpO1xufVxuXG5cbkN1cnNvclRleHQucHJvdG90eXBlLnN0YXJ0TWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHRpbWUpIHtcbiAgICB0aW1lID0gdGltZSB8fCAxMDAwO1xuICAgIHRoaXMudGV4dC50ZXh0ID0gbWVzc2FnZTtcbiAgICBpZiAodGhpcy50aW1lci5ydW5uaW5nKSB7XG4gICAgICAgIHRoaXMudGltZXIuc3RvcCgpO1xuICAgIH1cbiAgICB0aGlzLnRpbWVyLmFkZCh0aW1lLCB0aGlzLmVuZE1lc3NhZ2UsIHRoaXMpO1xuICAgIHRoaXMudGltZXIuc3RhcnQoKTtcbn07XG5DdXJzb3JUZXh0LnByb3RvdHlwZS5lbmRNZXNzYWdlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50ZXh0LnRleHQgPSAnJztcbiAgICB0aGlzLnRpbWVyLnN0b3AoKTtcbn07XG52YXIgdXBkYXRlUG9zaXRpb24gPSBmdW5jdGlvbihjdXJzb3IsIG9mZnNldCkge1xuICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgIHRoaXMucG9zaXRpb24ueCA9IGN1cnNvci54ICsgb2Zmc2V0O1xuICAgICAgIHRoaXMucG9zaXRpb24ueSA9IGN1cnNvci55IC0gb2Zmc2V0O1xuICAgfVxufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IEN1cnNvclRleHQ7XG5cbiIsIkNsaWNrYWJsZSA9IHJlcXVpcmUoJy4vY2xpY2thYmxlJyk7XG5cbkRvb3IgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkRvb3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGlja2FibGUucHJvdG90eXBlKTtcblxuRG9vci5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uKGN1cnNvciwgc3RhdGUpIHtcbiAgICB2YXIgdGFyZ2V0ID0gc3RhdGUucG9pbnRzW3RoaXMudGFyZ2V0XTtcbiAgICBzdGF0ZS5wbGF5ZXIubW92ZVRvKHRhcmdldC54LCB0YXJnZXQueSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKHRhcmdldC5wcm9wZXJ0aWVzLm5leHRTcGF3blBvaW50KSB7XG4gICAgICAgICAgICBwbGF5ZXJTdGF0ZS5zcGF3blBvaW50ID0gdGFyZ2V0LnByb3BlcnRpZXMubmV4dFNwYXduUG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUuZ2FtZS5zdGF0ZS5zdGFydCh0YXJnZXQucHJvcGVydGllcy5kZXN0aW5hdGlvbik7XG4gICAgfSk7XHRcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBEb29yO1xuIiwiQ2xpY2thYmxlID0gcmVxdWlyZSgnLi9jbGlja2FibGUnKTtcblxuRmxvb3IgPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkZsb29yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xpY2thYmxlLnByb3RvdHlwZSk7XG5cbkZsb29yLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24oY3Vyc29yLCBzdGF0ZSkge1xuICAgIHN0YXRlLnBsYXllci5tb3ZlVG8oY3Vyc29yLngsIGN1cnNvci55KTtcdFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEZsb29yO1xuIiwiQ2xpY2thYmxlID0gcmVxdWlyZSgnLi9jbGlja2FibGUnKTtcblxuTGlnaHRTd2l0Y2ggPSBmdW5jdGlvbihnYW1lLCB0aWxlZE9iaikge1xuICAgIENsaWNrYWJsZS5jYWxsKHRoaXMsIGdhbWUsIHRpbGVkT2JqKTtcbn1cbkxpZ2h0U3dpdGNoLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xpY2thYmxlLnByb3RvdHlwZSk7XG5cbkxpZ2h0U3dpdGNoLnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24oY3Vyc29yLCBzdGF0ZSkge1xuICAgIGNvbnNvbGUubG9nKCdMSUdIVCBTV0lUQ0gnKTtcbiAgICBpbWFnZS5ldmVudHMub25JbnB1dE92ZXIuYWRkKG92ZXIsIHRoaXMpO1xuICAgIGltYWdlLmV2ZW50cy5vbklucHV0T3V0LmFkZChvdXQsIHRoaXMpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IExpZ2h0U3dpdGNoO1xuIiwidmFyIFBsYXllciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG5cdFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAnaGFwcHktbWFuJyk7XG5cdGdhbWUuYWRkLmV4aXN0aW5nKHRoaXMpO1xuXG5cdHRoaXMubW92ZW1lbnQ7XG5cdHRoaXMuYW5jaG9yLnNldFRvKDAuNSwgMC45NSk7XG5cdFx0XG59O1xuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xufTtcblxuUGxheWVyLnByb3RvdHlwZS5tb3ZlVG8gPSBmdW5jdGlvbih4LCB5LCBkb25lKSB7XG5cdGlmICh0aGlzLm1vdmVtZW50ICYmIHRoaXMubW92ZW1lbnQuaXNSdW5uaW5nKSB7XG5cdFx0dGhpcy5tb3ZlbWVudC5zdG9wKCk7XG5cdH1cblxuXHR2YXIgZHVyYXRpb24gPSAodGhpcy5nYW1lLnBoeXNpY3MuYXJjYWRlLmRpc3RhbmNlVG9YWSh0aGlzLCB4LCB5KSAvIDMwMCkgKiAxMDAwO1xuXHR0aGlzLm1vdmVtZW50ID0gdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzKVxuXHRcdC50byh7IHg6IHgsIHk6IHkgfSwgZHVyYXRpb24sIFBoYXNlci5FYXNpbmcuTGluZWFyLk5vbmUsIHRydWUpO1xuXHRpZihkb25lKSB7XG5cdFx0dGhpcy5tb3ZlbWVudC5vbkNvbXBsZXRlLmFkZChkb25lLCB0aGlzKTtcblx0fVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDEwMjQsIDc2OCwgUGhhc2VyLkFVVE8sICdzYWdkYy1nYW1lJyk7XG5cbndpbmRvdy5VdGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcbndpbmRvdy5wbGF5ZXJTdGF0ZSA9IHtcbiAgICBVVUlEOiAnJyxcbiAgICBpbnZlbnRvcnk6IFtdLCAvLyBMaXN0IG9mIEl0ZW1cbiAgICBjdXJyZW50bHlFcXVpcHBlZDogbnVsbCwgLy8gSXRlbVxuICAgIGN1cnJlbnRMZXZlbDogJ0JsdWVSb29tJ1xufVxuXG5pZiAoVXRpbHMubG9jYWxTdG9yYWdlU3VwcG9ydGVkKCkpIHtcbiAgICAgaWYgKGxvY2FsU3RvcmFnZVsncGxheWVyU3RhdGUnXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHBsYXllclN0YXRlID0gVXRpbHMuZ2V0T2JqZWN0KCdwbGF5ZXJTdGF0ZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHBsYXllclN0YXRlLlVVSUQgPSBVdGlscy5nZW5lcmF0ZVVVSUQoKTsgICBcbiAgICAgICAgVXRpbHMuc2V0T2JqZWN0KCdwbGF5ZXJTdGF0ZScsIHBsYXllclN0YXRlKTtcbiAgICB9XG59IGVsc2Uge1xuICAgIGFsZXJ0KFwiTG9jYWwgc3RvcmFnZSBub3Qgc3VwcG9ydGVkIC0geW91IGNhbm5vdCBzYXZlIVwiKTtcbn1cblxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XG5nYW1lLnN0YXRlLmFkZCgnTWVudScsIHJlcXVpcmUoJy4vc3RhdGVzL21lbnUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnQmx1ZVJvb20nLCByZXF1aXJlKCcuL3N0YXRlcy9ibHVlX3Rlc3Rfcm9vbScpKTtcbmdhbWUuc3RhdGUuYWRkKCdSZWRSb29tJywgcmVxdWlyZSgnLi9zdGF0ZXMvcmVkX3Rlc3Rfcm9vbScpKTtcblxuZ2FtZS5zdGF0ZS5zdGFydCgnQm9vdCcpO1xuIiwidmFyIEdhbWVTY3JlZW4gPSByZXF1aXJlKCcuLi9zdGF0ZXMvZ2FtZV9zY3JlZW4nKTtcblxudmFyIEJsdWVSb29tID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tYXAgPSBudWxsO1xufTtcblxuQmx1ZVJvb20ucHJvdG90eXBlID0gbmV3IEdhbWVTY3JlZW4oKTtcbkJsdWVSb29tLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbigpIHtcbiAgICBwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPSAnQmx1ZVJvb20nO1xuXG4gICAgdmFyIGJnID0gdGhpcy5nYW1lLmFkZC5pbWFnZSgwLCAwLCAnYmx1ZV9yb29tJyk7XG5cbiAgICB0aGlzLm1hcCA9IHRoaXMuZ2FtZS5hZGQudGlsZW1hcCgnYmx1ZV9yb29tJyk7XG5cbiAgICB0aGlzLmluaXRTY3JlZW4oKTtcblxuICAgIC8vb3ZlcnJpZGluZyB0aGUgZGVmYXVsdCBiZWhhdmlvciBvZiB0aGUgbGlnaHRTd2l0Y2hcbiAgICB0aGlzLmNsaWNrYWJsZXMubGlnaHRTd2l0Y2gub25DbGljayA9IGZ1bmN0aW9uKGN1cnNvciwgc3RhdGUpe1xuICAgICAgICB2YXIgcGxheWVyID0gc3RhdGUucGxheWVyO1xuICAgICAgICBwbGF5ZXIubW92ZVRvKHRoaXMueCwgdGhpcy55ICsgKHBsYXllci5oZWlnaHQgLyAyKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTElHSFRTIE9VVCwgTU9USEVSRlVDS0VSJyk7XG4gICAgICAgIH0pO1xuICAgIH07XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJsdWVSb29tO1xuIiwidmFyIEJvb3QgPSBmdW5jdGlvbiAoKSB7fTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuXG4gICAgaWYgKHRoaXMuZ2FtZS5kZXZpY2UuZGVza3RvcCkge1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZU1vZGUgPSBQaGFzZXIuU3RhZ2VTY2FsZU1vZGUuU0hPV19BTEw7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUubWluV2lkdGggPSAgNDgwO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLm1pbkhlaWdodCA9IDI2MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5tYXhXaWR0aCA9IDY0MDtcbiAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5tYXhIZWlnaHQgPSA0ODA7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUuZm9yY2VMYW5kc2NhcGUgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnN0YWdlLnNjYWxlLnBhZ2VBbGlnbkhvcml6b250YWxseSA9IHRydWU7XG4gICAgICB0aGlzLmdhbWUuc3RhZ2Uuc2NhbGUuc2V0U2NyZWVuU2l6ZSh0cnVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ1ByZWxvYWRlcicpO1xuICB9XG59O1xuIiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL3BsYXllcicpO1xuXG52YXIgR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50ZXN0ZW50aXR5ID0gbnVsbDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcblxuR2FtZS5wcm90b3R5cGUgPSB7XG5cbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHggPSAodGhpcy5nYW1lLndpZHRoIC8gMikgLSAxMDA7XG4gICAgdmFyIHkgPSAodGhpcy5nYW1lLmhlaWdodCAvIDIpIC0gNTA7XG5cbiAgICB0aGlzLnRlc3RlbnRpdHkgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgeCwgeSk7XG4gICAgdGhpcy50ZXN0ZW50aXR5LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbklucHV0RG93biwgdGhpcyk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHgsIHksIGN4LCBjeSwgZHgsIGR5LCBhbmdsZSwgc2NhbGU7XG5cbiAgICB4ID0gdGhpcy5pbnB1dC5wb3NpdGlvbi54O1xuICAgIHkgPSB0aGlzLmlucHV0LnBvc2l0aW9uLnk7XG4gICAgY3ggPSB0aGlzLndvcmxkLmNlbnRlclg7XG4gICAgY3kgPSB0aGlzLndvcmxkLmNlbnRlclk7XG5cbiAgICBhbmdsZSA9IE1hdGguYXRhbjIoeSAtIGN5LCB4IC0gY3gpICogKDE4MCAvIE1hdGguUEkpO1xuICAgIHRoaXMudGVzdGVudGl0eS5hbmdsZSA9IGFuZ2xlO1xuXG4gICAgZHggPSB4IC0gY3g7XG4gICAgZHkgPSB5IC0gY3k7XG4gICAgc2NhbGUgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpIC8gMTAwO1xuXG4gICAgdGhpcy50ZXN0ZW50aXR5LnNjYWxlLnggPSBzY2FsZSAqIDAuNjtcbiAgICB0aGlzLnRlc3RlbnRpdHkuc2NhbGUueSA9IHNjYWxlICogMC42O1xuICB9LFxuXG4gIG9uSW5wdXREb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gIH1cbn07XG4iLCIvL21haW4gZ2FtZSBzY3JlZW4gdGhhdCB0aGUgdmFyaW91cyBzY2VuZXMgd2lsbCBpbmhlcml0XG5cbnZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9wbGF5ZXInKTtcbnZhciBDbGlja2FibGVNYWtlciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2NsaWNrYWJsZV9tYWtlcicpO1xudmFyIEN1cnNvclRleHQgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9jdXJzb3JfdGV4dCcpO1xuXG52YXIgR2FtZVNjcmVlbiA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucGxheWVyID0gbnVsbDtcbn07XG5cbkdhbWVTY3JlZW4ucHJvdG90eXBlID0ge1xuICAgIGluaXRTY3JlZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnBvaW50cyA9IHRoaXMuZXh0cmFjdFBvaW50c0Zyb21UaWxlTWFwTGF5ZXIodGhpcy5tYXAub2JqZWN0cy5wb2ludHMpO1xuICAgICAgICB0aGlzLmNsaWNrYWJsZXMgPSB0aGlzLmV4dHJhY3RDbGlja2FibGVzRnJvbVRpbGVNYXBMYXllcih0aGlzLm1hcC5vYmplY3RzLmNsaWNrYWJsZXMpO1xuXG4gICAgICAgIHRoaXMuY3Vyc29yVGV4dCA9IG5ldyBDdXJzb3JUZXh0KHRoaXMuZ2FtZSk7XG5cbiAgICAgICAgaWYocGxheWVyU3RhdGUuc3Bhd25Qb2ludCAmJiB0aGlzLnBvaW50c1twbGF5ZXJTdGF0ZS5zcGF3blBvaW50XSkge1xuICAgICAgICAgICAgdmFyIHBvaW50ID0gdGhpcy5wb2ludHNbcGxheWVyU3RhdGUuc3Bhd25Qb2ludF07XG4gICAgICAgICAgICB2YXIgeCA9IHBvaW50Lng7XG4gICAgICAgICAgICB2YXIgeSA9IHBvaW50Lnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgeCA9ICh0aGlzLmdhbWUud2lkdGggLyAyKTtcbiAgICAgICAgICAgIHZhciB5ID0gKHRoaXMuZ2FtZS5oZWlnaHQgLyAyKSArIDI1MDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIodGhpcy5nYW1lLCB4LCB5KTtcblxuICAgICAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5jbGlja0NsaWNrYWJsZXMsIHRoaXMpO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgY2xpY2tDbGlja2FibGVzOiBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgZm9yKGkgaW4gdGhpcy5jbGlja2FibGVzKSB7XG4gICAgICAgICAgICB2YXIgY2xpY2thYmxlID0gdGhpcy5jbGlja2FibGVzW2ldO1xuICAgICAgICAgICAgaWYoY2xpY2thYmxlLmluY2x1ZGVzUG9pbnQoY3Vyc29yLngsIGN1cnNvci55KSkge1xuICAgICAgICAgICAgICAgIGNsaWNrYWJsZS5jbGljayhjdXJzb3IsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGV4dHJhY3RQb2ludHNGcm9tVGlsZU1hcExheWVyOiBmdW5jdGlvbihsYXllcikge1xuICAgICAgICB2YXIgcG9pbnRzID0ge307XG4gICAgICAgIGZvcihpIGluIGxheWVyKSB7XG4gICAgICAgICAgICBwb2ludCA9IGxheWVyW2ldO1xuICAgICAgICAgICAgcG9pbnRzW3BvaW50Lm5hbWVdID0gcG9pbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBvaW50cztcbiAgICB9LFxuXG4gICAgZXh0cmFjdENsaWNrYWJsZXNGcm9tVGlsZU1hcExheWVyOiBmdW5jdGlvbihsYXllcikge1xuICAgICAgICB2YXIgY2xpY2thYmxlcyA9IHt9O1xuICAgICAgICBmb3IoaSBpbiBsYXllcikge1xuICAgICAgICAgICAgdmFyIGNsaWNrYWJsZSA9IENsaWNrYWJsZU1ha2VyLmNyZWF0ZSh0aGlzLmdhbWUsIGxheWVyW2ldKTtcbiAgICAgICAgICAgIGlmKGNsaWNrYWJsZSkgeyBjbGlja2FibGVzW2NsaWNrYWJsZS5uYW1lXSA9IGNsaWNrYWJsZTsgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjbGlja2FibGVzO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IoaSBpbiB0aGlzLmNsaWNrYWJsZXMpIHtcbiAgICAgICAgICAgIHZhciBjbGlja2FibGUgPSB0aGlzLmNsaWNrYWJsZXNbaV07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNoZWNrQ2xpY2thYmxlSG92ZXIoY2xpY2thYmxlLCB0aGlzLmdhbWUuaW5wdXQubW91c2VQb2ludGVyLCB0aGlzLmN1cnNvclRleHQpO1xuICAgICAgICB9XG4gICAgfVxufTtcblxudmFyIGNoZWNrQ2xpY2thYmxlSG92ZXIgPSBmdW5jdGlvbihjbGlja2FibGUsIGN1cnNvciwgY3Vyc29yVGV4dCkge1xuICAgIGlmKGNsaWNrYWJsZS5ob3ZlclRleHQgJiYgY2xpY2thYmxlLmluY2x1ZGVzUG9pbnQoY3Vyc29yLngsIGN1cnNvci55KSkge1xuICAgICAgICBjdXJzb3JUZXh0LnN0YXJ0TWVzc2FnZShjbGlja2FibGUuaG92ZXJUZXh0KTsgXG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBHYW1lU2NyZWVuO1xuIiwidmFyIE1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGV4dCA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnU7XG5cbk1lbnUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciB4ID0gdGhpcy5nYW1lLndpZHRoIC8gMjtcbiAgICB2YXIgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xuXG4gICAgdmFyIHN0eWxlID0geyBmb250OiBcIjY1cHggQXJpYWxcIiwgZmlsbDogXCIjZmZmZmZmXCIsIGFsaWduOiBcImNlbnRlclwiIH07XG5cbiAgICB0aGlzLnRleHQgPSB0aGlzLmFkZC50ZXh0KHggLSAzMDAsIHkgLSAyMDAsIFwiUHJlc3MgdG8gU3RhcnRcIiwgc3R5bGUpO1xuXG4gICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMub25Eb3duLCB0aGlzKTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgfSxcblxuICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQocGxheWVyU3RhdGUuY3VycmVudExldmVsKTtcbiAgfVxufTtcbiIsInZhciBQcmVsb2FkZXIgPSBmdW5jdGlvbiAoZ2FtZSkge1xuICB0aGlzLmFzc2V0ID0gbnVsbDtcbiAgdGhpcy5yZWFkeSA9IGZhbHNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQcmVsb2FkZXI7XG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUoMzIwLCAyNDAsICdwcmVsb2FkZXInKTtcbiAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICB0aGlzLmxvYWQub25Mb2FkQ29tcGxldGUuYWRkT25jZSh0aGlzLm9uTG9hZENvbXBsZXRlLCB0aGlzKTtcbiAgICB0aGlzLmxvYWQuc2V0UHJlbG9hZFNwcml0ZSh0aGlzLmFzc2V0KTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3Rlc3RzcHJpdGUnLCAnYXNzZXRzL3Rlc3QucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdoYXBweS1tYW4nLCAnYXNzZXRzL2hhcHB5LW1hbi5wbmcnKTtcbiAgICB0aGlzLmxvYWQudGlsZW1hcCgnYmx1ZV9yb29tJywgJ2Fzc2V0cy90aWxlbWFwcy9ibHVlX3Jvb20uanNvbicsIG51bGwsIFBoYXNlci5UaWxlbWFwLlRJTEVEX0pTT04pO1xuICAgIHRoaXMubG9hZC50aWxlbWFwKCdyZWRfcm9vbScsICdhc3NldHMvdGlsZW1hcHMvcmVkX3Jvb20uanNvbicsIG51bGwsIFBoYXNlci5UaWxlbWFwLlRJTEVEX0pTT04pO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnYmx1ZV9yb29tJywgJ2Fzc2V0cy90ZXN0X2JnX2JsdWUuanBnJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdyZWRfcm9vbScsICdhc3NldHMvdGVzdF9iZ19yZWQuanBnJyk7XG4gICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdsaWdodF9zd2l0Y2gnLCAnYXNzZXRzL2xpZ2h0X3N3aXRjaC5wbmcnLCAzMiwgMzIpO1xuICB9LFxuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcblxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoISF0aGlzLnJlYWR5KSB7XG4gICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9XG4gIH0sXG5cbiAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgfVxufTtcbiIsInZhciBHYW1lU2NyZWVuID0gcmVxdWlyZSgnLi4vc3RhdGVzL2dhbWVfc2NyZWVuJyk7XG5cbnZhciBSZWRSb29tID0gZnVuY3Rpb24oKSB7XG5cdHRoaXMubWFwID0gbnVsbDtcbn07XG5cblJlZFJvb20ucHJvdG90eXBlID0gbmV3IEdhbWVTY3JlZW4oKTtcblJlZFJvb20ucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uKCkge1xuXHRwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwgPSAnUmVkUm9vbSc7XG5cblx0dmFyIGJnID0gdGhpcy5nYW1lLmFkZC5pbWFnZSgwLCAwLCAncmVkX3Jvb20nKTtcblxuXHR0aGlzLm1hcCA9IHRoaXMuZ2FtZS5hZGQudGlsZW1hcCgncmVkX3Jvb20nKTtcblxuXHR0aGlzLmluaXRTY3JlZW4oKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUmVkUm9vbTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn07IiwidmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbihvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIGxvY2FsU3RvcmFnZVN1cHBvcnRlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gJ2xvY2FsU3RvcmFnZScgaW4gd2luZG93ICYmIHdpbmRvd1snbG9jYWxTdG9yYWdlJ10gIT09IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZW5lcmF0ZVVVSUQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBkID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdmFyIHV1aWQgPSAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpKjE2KSUxNiB8IDA7XG4gICAgICAgICAgICBkID0gTWF0aC5mbG9vcihkLzE2KTtcbiAgICAgICAgICAgIHJldHVybiAoYz09J3gnID8gciA6IChyJjB4N3wweDgpKS50b1N0cmluZygxNik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdXVpZDtcbiAgICB9LFxuXG4gICAgZ2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIHJldHVybiB2YWx1ZSAmJiBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICB9LFxuXG4gICAgc2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9LFxuXG4gICAgZXh0ZW5kOiBmdW5jdGlvbiAodGFyZ2V0LCBvdGhlcikge1xuICAgICAgZm9yICh2YXIgcHJvcCBpbiBvdGhlcikge1xuICAgICAgICBpZiAodHlwZW9mIG90aGVyW3Byb3BdID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHRhcmdldFtwcm9wXSA9IGV4dGVuZCh0YXJnZXRbcHJvcF0sIG90aGVyW3Byb3BdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0YXJnZXRbcHJvcF0gPSBvdGhlcltwcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFV0aWxzO1xuIl19
